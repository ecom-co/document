<!doctype html>
<html lang="vi" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-microservices/communication/grpc-protocol" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">gRPC Protocol | NestJS Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ecom-co.github.io/document/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ecom-co.github.io/document/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ecom-co.github.io/document/docs/microservices/communication/grpc-protocol"><meta data-rh="true" property="og:locale" content="vi"><meta data-rh="true" name="docusaurus_locale" content="vi"><meta data-rh="true" name="docsearch:language" content="vi"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="gRPC Protocol | NestJS Documentation"><meta data-rh="true" name="description" content="Tìm hiểu về gRPC Protocol - Google Remote Procedure Call, protocol hiệu suất cao cho microservices"><meta data-rh="true" property="og:description" content="Tìm hiểu về gRPC Protocol - Google Remote Procedure Call, protocol hiệu suất cao cho microservices"><link data-rh="true" rel="icon" href="/document/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ecom-co.github.io/document/docs/microservices/communication/grpc-protocol"><link data-rh="true" rel="alternate" href="https://ecom-co.github.io/document/docs/microservices/communication/grpc-protocol" hreflang="vi"><link data-rh="true" rel="alternate" href="https://ecom-co.github.io/document/docs/microservices/communication/grpc-protocol" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"gRPC Protocol","item":"https://ecom-co.github.io/document/docs/microservices/communication/grpc-protocol"}]}</script><link rel="alternate" type="application/rss+xml" href="/document/blog/rss.xml" title="NestJS Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/document/blog/atom.xml" title="NestJS Documentation Atom Feed"><link rel="stylesheet" href="/document/assets/css/styles.82925b1f.css">
<script src="/document/assets/js/runtime~main.ddb7da7d.js" defer="defer"></script>
<script src="/document/assets/js/main.9b8e79c8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/document/img/logo.svg"><div role="region" aria-label="Chuyển tới nội dung chính"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Chuyển tới nội dung chính</a></div><nav aria-label="Thanh điều hướng" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Đóng - mở thanh điều hướng" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/document/"><div class="navbar__logo"><img src="/document/img/logo.svg" alt="NestJS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/document/img/logo.svg" alt="NestJS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NestJS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/document/docs/">Docs</a><a class="navbar__item navbar__link" href="/document/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Tìm kiếm..." aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/ecom-co/document" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Tiếng Việt</a><ul class="dropdown__menu"><li><a href="/document/docs/microservices/communication/grpc-protocol" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="vi">Tiếng Việt</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Chuyển đổi chế độ sáng và tối (hiện tại là system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Trở lại đầu trang" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Thanh điều hướng tài liệu" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/document/docs/">NestJS là gì?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/document/docs/installation">Cài đặt NestJS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/document/docs/overview/modules">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/document/docs/tips/circular-dependency">Tips &amp; Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/document/docs/http-exception/http-methods">HTTP &amp; Exception Handling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/document/docs/microservices/microservices-overview">Microservices &amp; Communication</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/microservices-overview">Microservices Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/document/docs/microservices/communication/communication-overview">Communication Protocols</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/communication/communication-overview">Communication Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/document/docs/microservices/communication/grpc-protocol">gRPC Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/communication/rest-protocol">REST Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/communication/message-queues">Message Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/communication/websockets">WebSockets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/communication/event-driven">Event-Driven Communication</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/service-discovery">Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/load-balancing">Load Balancing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/microservices-patterns">Microservices Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/microservices-testing">Microservices Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/document/docs/microservices/microservices-deployment">Microservices Deployment</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/document/docs/ecom-co/ecom-co-overview">Ecom-co Libraries</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Liên kết điều hướng"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Trang chủ" class="breadcrumbs__link" href="/document/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Microservices &amp; Communication</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Communication Protocols</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">gRPC Protocol</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Trên trang này</button></div><div class="theme-doc-markdown markdown"><header><h1>gRPC Protocol</h1></header>
<p>gRPC (Google Remote Procedure Call) là một framework RPC hiện đại, hiệu suất cao sử dụng Protocol Buffers để serialize data. Nó được thiết kế để hoạt động hiệu quả trong microservices architecture.</p>
<!-- -->
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>💡 Khái niệm cơ bản</div><div class="admonitionContent_BuS1"><p>gRPC giống như &quot;điện thoại trực tiếp&quot; giữa các services - gọi trực tiếp và nhận response ngay lập tức với hiệu suất cao.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-là-gì">gRPC là gì?<a href="#grpc-là-gì" class="hash-link" aria-label="Đường dẫn trực tiếp đến gRPC là gì?" title="Đường dẫn trực tiếp đến gRPC là gì?">​</a></h2>
<p><strong>Lý thuyết cơ bản:</strong>
gRPC là một framework RPC (Remote Procedure Call) hiện đại, sử dụng HTTP/2 làm transport layer và Protocol Buffers làm interface definition language. gRPC được thiết kế để cung cấp hiệu suất cao, cross-platform và hỗ trợ nhiều ngôn ngữ lập trình.</p>
<p><strong>Đặc điểm kỹ thuật:</strong></p>
<ul>
<li><strong>HTTP/2 Transport</strong>: Sử dụng HTTP/2 với multiplexing và server push</li>
<li><strong>Protocol Buffers</strong>: Schema-first approach với binary serialization</li>
<li><strong>Strong Typing</strong>: Type safety across different languages</li>
<li><strong>Bidirectional Streaming</strong>: Hỗ trợ streaming data</li>
</ul>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Service Definition</strong>: Định nghĩa service interface bằng .proto file</li>
<li><strong>Code Generation</strong>: Tự động generate client/server code</li>
<li><strong>Binary Communication</strong>: Giao tiếp bằng binary protocol</li>
<li><strong>HTTP/2 Features</strong>: Tận dụng HTTP/2 multiplexing</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Request State</strong>: Serialized → Transmitted → Deserialized → Processed</li>
<li><strong>Connection State</strong>: Idle → Active → Streaming → Idle</li>
<li><strong>Data Format</strong>: Text → Binary → Structured Data</li>
</ul>
<p><strong>Điểm mạnh (Strengths):</strong></p>
<ul>
<li><strong>High Performance</strong>: Binary protocol, HTTP/2 multiplexing, connection pooling</li>
<li><strong>Type Safety</strong>: Generated code với strong typing, compile-time error checking</li>
<li><strong>Efficient</strong>: Compression tự động, connection reuse, low memory overhead</li>
<li><strong>Cross-Platform</strong>: Hỗ trợ nhiều ngôn ngữ (Java, C++, Python, Go, Node.js)</li>
<li><strong>Streaming Support</strong>: Bidirectional streaming, real-time communication</li>
<li><strong>Schema Evolution</strong>: Backward compatibility, version management</li>
<li><strong>Load Balancing</strong>: Built-in load balancing và health checking</li>
</ul>
<p><strong>Điểm yếu (Weaknesses):</strong></p>
<ul>
<li><strong>Complexity</strong>: Phức tạp hơn REST, cần hiểu RPC concepts</li>
<li><strong>Debugging</strong>: Khó debug binary protocol, cần special tools</li>
<li><strong>Browser Support</strong>: Hạn chế trong browsers, chủ yếu cho server-to-server</li>
<li><strong>Learning Curve</strong>: Cần học Protocol Buffers, gRPC concepts</li>
<li><strong>Tooling</strong>: Ít tools hỗ trợ so với REST, debugging khó khăn</li>
<li><strong>Human Readability</strong>: Binary format không đọc được, khó troubleshoot</li>
<li><strong>Network Issues</strong>: Khó handle network problems, firewall issues</li>
<li><strong>File Upload Limitations</strong>: Không phù hợp cho file upload lớn, memory issues</li>
<li><strong>Message Size Constraints</strong>: Có giới hạn về kích thước message</li>
<li><strong>Streaming Complexity</strong>: Bidirectional streaming phức tạp để implement</li>
<li><strong>Stateful Connections</strong>: HTTP/2 connections có thể gây memory leaks</li>
<li><strong>Load Balancing Challenges</strong>: Khó implement load balancing cho gRPC</li>
<li><strong>Service Discovery</strong>: Cần special service discovery mechanisms</li>
<li><strong>Security Complexity</strong>: TLS, authentication phức tạp hơn REST</li>
<li><strong>Testing Difficulties</strong>: Unit testing và integration testing phức tạp</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="khi-nào-nên-dùng-và-khi-nào-không-nên-dùng-grpc">Khi nào nên dùng và khi nào không nên dùng gRPC<a href="#khi-nào-nên-dùng-và-khi-nào-không-nên-dùng-grpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến Khi nào nên dùng và khi nào không nên dùng gRPC" title="Đường dẫn trực tiếp đến Khi nào nên dùng và khi nào không nên dùng gRPC">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="khi-nào-nên-dùng-grpc"><strong>Khi nào NÊN dùng gRPC:</strong><a href="#khi-nào-nên-dùng-grpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến khi-nào-nên-dùng-grpc" title="Đường dẫn trực tiếp đến khi-nào-nên-dùng-grpc">​</a></h3>
<p><strong>1. High-Performance Requirements:</strong></p>
<ul>
<li><strong>Microservices Communication</strong>: Service-to-service communication cần performance cao</li>
<li><strong>Real-time Applications</strong>: Chat apps, live streaming, gaming</li>
<li><strong>High-throughput Systems</strong>: Data processing, analytics, ETL pipelines</li>
<li><strong>Low-latency Requirements</strong>: Financial trading, real-time monitoring</li>
</ul>
<p><strong>2. Strong Type Safety:</strong></p>
<ul>
<li><strong>Enterprise Applications</strong>: Cần contract enforcement</li>
<li><strong>API Versioning</strong>: Cần backward compatibility</li>
<li><strong>Multi-language Teams</strong>: Teams sử dụng nhiều ngôn ngữ khác nhau</li>
<li><strong>Contract-first Development</strong>: API design trước, implementation sau</li>
</ul>
<p><strong>3. Streaming Requirements:</strong></p>
<ul>
<li><strong>Bidirectional Communication</strong>: Chat, notifications, real-time updates</li>
<li><strong>Small Data Streaming</strong>: Sensor data, real-time metrics, status updates</li>
<li><strong>Event-driven Systems</strong>: Real-time event processing</li>
<li><strong>IoT Applications</strong>: Device communication, sensor data</li>
<li><strong>Real-time Analytics</strong>: Live dashboards, monitoring data</li>
</ul>
<p><strong>4. Server-to-Server Communication:</strong></p>
<ul>
<li><strong>Internal APIs</strong>: Không cần browser access</li>
<li><strong>Backend Services</strong>: Database services, cache services</li>
<li><strong>Infrastructure Services</strong>: Monitoring, logging, configuration</li>
<li><strong>Cloud-native Applications</strong>: Kubernetes, Docker environments</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="khi-nào-không-nên-dùng-grpc"><strong>Khi nào KHÔNG NÊN dùng gRPC:</strong><a href="#khi-nào-không-nên-dùng-grpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến khi-nào-không-nên-dùng-grpc" title="Đường dẫn trực tiếp đến khi-nào-không-nên-dùng-grpc">​</a></h3>
<p><strong>1. Browser-based Applications:</strong></p>
<ul>
<li><strong>Web Frontends</strong>: Browsers không hỗ trợ gRPC trực tiếp</li>
<li><strong>Public APIs</strong>: APIs cần browser access</li>
<li><strong>Mobile Web Apps</strong>: Progressive web applications</li>
<li><strong>Third-party Integrations</strong>: External services cần REST</li>
</ul>
<p><strong>2. Simple CRUD Operations:</strong></p>
<ul>
<li><strong>Basic APIs</strong>: CRUD operations đơn giản</li>
<li><strong>Admin Panels</strong>: Simple data management</li>
<li><strong>Reporting Tools</strong>: Basic data retrieval</li>
<li><strong>Simple Integrations</strong>: Third-party service connections</li>
</ul>
<p><strong>3. Human-readable Requirements:</strong></p>
<ul>
<li><strong>Debugging Needs</strong>: Cần đọc được request/response</li>
<li><strong>API Documentation</strong>: Cần human-readable format</li>
<li><strong>Testing Tools</strong>: Manual testing và debugging</li>
<li><strong>Support Teams</strong>: Technical support cần đọc logs</li>
</ul>
<p><strong>4. File Upload &amp; Large Data:</strong></p>
<ul>
<li><strong>File Upload Services</strong>: Upload files lớn, images, videos</li>
<li><strong>Document Processing</strong>: PDF processing, document uploads</li>
<li><strong>Media Streaming</strong>: Video streaming, audio streaming</li>
<li><strong>Data Import/Export</strong>: Bulk data operations, CSV processing</li>
</ul>
<p><strong>5. Load Balancing &amp; Service Discovery:</strong></p>
<ul>
<li><strong>Simple Load Balancers</strong>: Load balancers không hỗ trợ HTTP/2</li>
<li><strong>Basic Service Discovery</strong>: Không có service discovery infrastructure</li>
<li><strong>Stateless Requirements</strong>: Cần stateless communication</li>
<li><strong>Horizontal Scaling</strong>: Khó scale horizontally</li>
</ul>
<p><strong>6. Security &amp; Compliance:</strong></p>
<ul>
<li><strong>Strict Security Requirements</strong>: Cần special security configurations</li>
<li><strong>Compliance Needs</strong>: Regulatory compliance requirements</li>
<li><strong>Audit Logging</strong>: Cần detailed audit trails</li>
<li><strong>Access Control</strong>: Complex authentication/authorization</li>
</ul>
<p><strong>7. Testing &amp; Development:</strong></p>
<ul>
<li><strong>Rapid Prototyping</strong>: Cần quick API development</li>
<li><strong>Manual Testing</strong>: Cần manual API testing</li>
<li><strong>Debugging Requirements</strong>: Cần easy debugging</li>
<li><strong>Team Skills</strong>: Team không có gRPC experience</li>
</ul>
<p><strong>8. Legacy System Integration:</strong></p>
<ul>
<li><strong>Old Systems</strong>: Systems không hỗ trợ HTTP/2</li>
<li><strong>Firewall Restrictions</strong>: Corporate firewalls block gRPC</li>
<li><strong>Proxy Issues</strong>: Reverse proxies không hỗ trợ gRPC</li>
<li><strong>Load Balancer Limitations</strong>: Load balancers không hỗ trợ HTTP/2</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="giải-thích-chi-tiết-về-vấn-đề-file-upload"><strong>Giải thích chi tiết về vấn đề File Upload:</strong><a href="#giải-thích-chi-tiết-về-vấn-đề-file-upload" class="hash-link" aria-label="Đường dẫn trực tiếp đến giải-thích-chi-tiết-về-vấn-đề-file-upload" title="Đường dẫn trực tiếp đến giải-thích-chi-tiết-về-vấn-đề-file-upload">​</a></h3>
<p><strong>Tại sao gRPC không phù hợp cho file upload:</strong></p>
<p><strong>1. Memory Constraints:</strong></p>
<ul>
<li><strong>gRPC</strong>: Load toàn bộ file vào memory trước khi xử lý</li>
<li><strong>Vấn đề</strong>: Files lớn có thể gây out-of-memory errors</li>
<li><strong>Giải pháp</strong>: Cần implement chunked streaming phức tạp</li>
</ul>
<p><strong>2. Message Size Limits:</strong></p>
<ul>
<li><strong>gRPC</strong>: Có giới hạn về kích thước message (thường 4MB-100MB)</li>
<li><strong>REST</strong>: Không có giới hạn cứng, có thể handle files lớn</li>
<li><strong>Kết quả</strong>: gRPC bị giới hạn bởi message size</li>
</ul>
<p><strong>3. Streaming Complexity:</strong></p>
<ul>
<li><strong>gRPC</strong>: Bidirectional streaming phức tạp để implement</li>
<li><strong>File Upload</strong>: Cần chunked upload với progress tracking</li>
<li><strong>Kết quả</strong>: Code phức tạp, khó maintain</li>
</ul>
<p><strong>4. Performance Issues:</strong></p>
<ul>
<li><strong>Small Files</strong>: gRPC tốt hơn REST</li>
<li><strong>Large Files</strong>: REST tốt hơn gRPC</li>
<li><strong>Lý do</strong>: gRPC overhead cho files lớn</li>
</ul>
<p><strong>5. Alternative Solutions:</strong></p>
<ul>
<li><strong>REST + Multipart</strong>: Đơn giản, hiệu quả cho file upload</li>
<li><strong>Message Queues</strong>: Cho background file processing</li>
<li><strong>Direct File Storage</strong>: Upload trực tiếp đến cloud storage</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="các-vấn-đề-kỹ-thuật-khác"><strong>Các vấn đề kỹ thuật khác:</strong><a href="#các-vấn-đề-kỹ-thuật-khác" class="hash-link" aria-label="Đường dẫn trực tiếp đến các-vấn-đề-kỹ-thuật-khác" title="Đường dẫn trực tiếp đến các-vấn-đề-kỹ-thuật-khác">​</a></h3>
<p><strong>1. Connection Management:</strong></p>
<ul>
<li><strong>HTTP/2 Connections</strong>: Có thể gây memory leaks nếu không quản lý tốt</li>
<li><strong>Connection Pooling</strong>: Cần implement connection pooling đúng cách</li>
<li><strong>Keep-alive Issues</strong>: HTTP/2 keep-alive có thể gây vấn đề</li>
</ul>
<p><strong>2. Load Balancing Challenges:</strong></p>
<ul>
<li><strong>L7 Load Balancing</strong>: Cần load balancer hỗ trợ HTTP/2</li>
<li><strong>Sticky Sessions</strong>: Khó implement sticky sessions</li>
<li><strong>Health Checking</strong>: Health check phức tạp hơn HTTP/1.1</li>
</ul>
<p><strong>3. Service Discovery Issues:</strong></p>
<ul>
<li><strong>Dynamic Registration</strong>: Cần special service registry</li>
<li><strong>Health Monitoring</strong>: Health check phức tạp</li>
<li><strong>Load Distribution</strong>: Khó distribute load evenly</li>
</ul>
<p><strong>4. Security &amp; Compliance:</strong></p>
<ul>
<li><strong>TLS Configuration</strong>: Cần cấu hình TLS đúng cách</li>
<li><strong>Certificate Management</strong>: Certificate rotation phức tạp</li>
<li><strong>Audit Logging</strong>: Khó log binary requests</li>
<li><strong>Access Control</strong>: JWT, OAuth integration phức tạp</li>
</ul>
<p><strong>5. Testing &amp; Debugging:</strong></p>
<ul>
<li><strong>Unit Testing</strong>: Mock gRPC services phức tạp</li>
<li><strong>Integration Testing</strong>: End-to-end testing khó khăn</li>
<li><strong>Performance Testing</strong>: Load testing tools ít hỗ trợ gRPC</li>
<li><strong>Debugging Tools</strong>: Ít tools debug gRPC communication</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kiến-trúc-grpc">Kiến trúc gRPC<a href="#kiến-trúc-grpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến Kiến trúc gRPC" title="Đường dẫn trực tiếp đến Kiến trúc gRPC">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-grpc-flow---lý-thuyết-và-quy-trình">1. <strong>gRPC Flow - Lý thuyết và Quy trình</strong><a href="#1-grpc-flow---lý-thuyết-và-quy-trình" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-grpc-flow---lý-thuyết-và-quy-trình" title="Đường dẫn trực tiếp đến 1-grpc-flow---lý-thuyết-và-quy-trình">​</a></h3>
<p><strong>Lý thuyết về gRPC Flow:</strong>
gRPC sử dụng client-server architecture với code generation từ Protocol Buffer definitions. Client và server giao tiếp thông qua HTTP/2 với binary protocol.</p>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Proto Definition</strong>: Định nghĩa service interface</li>
<li><strong>Code Generation</strong>: Tự động tạo client stub và server skeleton</li>
<li><strong>Client Call</strong>: Client gọi method thông qua stub</li>
<li><strong>HTTP/2 Transport</strong>: Request được gửi qua HTTP/2</li>
<li><strong>Server Processing</strong>: Server xử lý request và trả về response</li>
<li><strong>Response Return</strong>: Response được trả về client</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Code State</strong>: Proto → Generated Code → Compiled → Running</li>
<li><strong>Request State</strong>: Method Call → Serialization → Transmission → Processing → Response</li>
<li><strong>Connection State</strong>: Established → Active → Idle</li>
</ul>
<p><strong>Ưu điểm của kiến trúc:</strong></p>
<ul>
<li><strong>Separation of Concerns</strong>: Interface definition tách biệt implementation</li>
<li><strong>Type Safety</strong>: Generated code đảm bảo type safety</li>
<li><strong>Performance</strong>: Binary protocol và HTTP/2 multiplexing</li>
<li><strong>Scalability</strong>: Connection pooling và load balancing</li>
</ul>
<p><strong>Nhược điểm:</strong></p>
<ul>
<li><strong>Complexity</strong>: Cần hiểu Protocol Buffers và gRPC concepts</li>
<li><strong>Debugging</strong>: Khó debug binary communication</li>
<li><strong>Tooling</strong>: Ít tools hỗ trợ so với REST</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-protocol-buffers---lý-thuyết-và-cấu-trúc">2. <strong>Protocol Buffers - Lý thuyết và Cấu trúc</strong><a href="#2-protocol-buffers---lý-thuyết-và-cấu-trúc" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-protocol-buffers---lý-thuyết-và-cấu-trúc" title="Đường dẫn trực tiếp đến 2-protocol-buffers---lý-thuyết-và-cấu-trúc">​</a></h3>
<p><strong>Lý thuyết về Protocol Buffers:</strong>
Protocol Buffers (protobuf) là một data serialization format được thiết kế bởi Google. Nó sử dụng schema-first approach, nơi bạn định nghĩa cấu trúc data trước, sau đó generate code cho nhiều ngôn ngữ lập trình.</p>
<p><strong>Đặc điểm kỹ thuật:</strong></p>
<ul>
<li><strong>Schema Definition</strong>: Định nghĩa cấu trúc data bằng .proto file</li>
<li><strong>Binary Format</strong>: Serialize data thành binary format</li>
<li><strong>Backward Compatibility</strong>: Hỗ trợ thay đổi schema mà không break existing code</li>
<li><strong>Language Agnostic</strong>: Hỗ trợ nhiều ngôn ngữ lập trình</li>
</ul>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Schema Definition</strong>: Viết .proto file định nghĩa service và messages</li>
<li><strong>Code Generation</strong>: Sử dụng protoc compiler để generate code</li>
<li><strong>Serialization</strong>: Convert data objects thành binary format</li>
<li><strong>Transmission</strong>: Gửi binary data qua network</li>
<li><strong>Deserialization</strong>: Convert binary data thành objects</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Data State</strong>: Structured Object → Serialized Binary → Transmitted → Deserialized → Structured Object</li>
<li><strong>Schema State</strong>: Proto Definition → Generated Code → Runtime Usage</li>
<li><strong>Performance</strong>: Text-based → Binary → Optimized</li>
</ul>
<p><strong>Ưu điểm:</strong></p>
<ul>
<li><strong>Efficiency</strong>: Binary format nhỏ hơn JSON/XML</li>
<li><strong>Type Safety</strong>: Strong typing với generated code</li>
<li><strong>Performance</strong>: Serialization/deserialization nhanh</li>
<li><strong>Schema Evolution</strong>: Hỗ trợ thay đổi schema</li>
</ul>
<p><strong>Nhược điểm:</strong></p>
<ul>
<li><strong>Human Readability</strong>: Binary format không đọc được</li>
<li><strong>Schema Dependency</strong>: Cần .proto file để deserialize</li>
<li><strong>Learning Curve</strong>: Cần học protobuf syntax</li>
<li><strong>Tooling</strong>: Ít tools hỗ trợ so với JSON</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cách-áp-dụng-grpc-hiệu-quả">Cách áp dụng gRPC hiệu quả<a href="#cách-áp-dụng-grpc-hiệu-quả" class="hash-link" aria-label="Đường dẫn trực tiếp đến Cách áp dụng gRPC hiệu quả" title="Đường dẫn trực tiếp đến Cách áp dụng gRPC hiệu quả">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-chiến-lược-áp-dụng-adoption-strategy"><strong>1. Chiến lược áp dụng (Adoption Strategy):</strong><a href="#1-chiến-lược-áp-dụng-adoption-strategy" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-chiến-lược-áp-dụng-adoption-strategy" title="Đường dẫn trực tiếp đến 1-chiến-lược-áp-dụng-adoption-strategy">​</a></h3>
<p><strong>Phase 1: Assessment &amp; Planning</strong></p>
<ul>
<li><strong>Evaluate Current Needs</strong>: Xác định performance bottlenecks</li>
<li><strong>Team Skills Assessment</strong>: Đánh giá team có đủ skills không</li>
<li><strong>Infrastructure Review</strong>: Kiểm tra HTTP/2 support</li>
<li><strong>Pilot Project</strong>: Chọn 1 service để test</li>
</ul>
<p><strong>Phase 2: Infrastructure Setup</strong></p>
<ul>
<li><strong>Load Balancer Configuration</strong>: Cấu hình HTTP/2 support</li>
<li><strong>Monitoring Setup</strong>: gRPC metrics và tracing</li>
<li><strong>Security Configuration</strong>: TLS, authentication</li>
<li><strong>Development Environment</strong>: Local development setup</li>
</ul>
<p><strong>Phase 3: Gradual Migration</strong></p>
<ul>
<li><strong>Start with Internal Services</strong>: Services không cần external access</li>
<li><strong>Parallel Implementation</strong>: Chạy song song với REST</li>
<li><strong>Performance Testing</strong>: So sánh performance</li>
<li><strong>Team Training</strong>: Training về gRPC concepts</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-best-practices-khi-áp-dụng"><strong>2. Best Practices khi áp dụng:</strong><a href="#2-best-practices-khi-áp-dụng" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-best-practices-khi-áp-dụng" title="Đường dẫn trực tiếp đến 2-best-practices-khi-áp-dụng">​</a></h3>
<p><strong>Design Principles:</strong></p>
<ul>
<li><strong>Contract-first Approach</strong>: Định nghĩa proto trước</li>
<li><strong>Service Granularity</strong>: Services vừa đủ, không quá nhỏ</li>
<li><strong>Error Handling</strong>: Standardized error codes và messages</li>
<li><strong>Versioning Strategy</strong>: Semantic versioning cho APIs</li>
</ul>
<p><strong>Performance Optimization:</strong></p>
<ul>
<li><strong>Connection Pooling</strong>: Reuse connections</li>
<li><strong>Streaming for Large Data</strong>: Sử dụng streaming cho data lớn</li>
<li><strong>Batch Operations</strong>: Gộp nhiều operations</li>
<li><strong>Caching Strategy</strong>: Implement proper caching</li>
</ul>
<p><strong>Monitoring &amp; Observability:</strong></p>
<ul>
<li><strong>gRPC Metrics</strong>: Request/response times, error rates</li>
<li><strong>Distributed Tracing</strong>: Track requests across services</li>
<li><strong>Health Checks</strong>: Service health monitoring</li>
<li><strong>Logging Strategy</strong>: Structured logging cho debugging</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-common-pitfalls-và-cách-tránh"><strong>3. Common Pitfalls và cách tránh:</strong><a href="#3-common-pitfalls-và-cách-tránh" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3-common-pitfalls-và-cách-tránh" title="Đường dẫn trực tiếp đến 3-common-pitfalls-và-cách-tránh">​</a></h3>
<p><strong>Technical Issues:</strong></p>
<ul>
<li><strong>❌ Không test performance</strong>: Test performance trước khi migrate</li>
<li><strong>❌ Ignore error handling</strong>: Implement proper error handling</li>
<li><strong>❌ Skip monitoring</strong>: Setup monitoring từ đầu</li>
<li><strong>❌ Forget versioning</strong>: Plan versioning strategy</li>
</ul>
<p><strong>Organizational Issues:</strong></p>
<ul>
<li><strong>❌ No team training</strong>: Train team về gRPC</li>
<li><strong>❌ Rush migration</strong>: Migrate từng bước, không vội</li>
<li><strong>❌ Ignore documentation</strong>: Document APIs và processes</li>
<li><strong>❌ Skip testing</strong>: Comprehensive testing strategy</li>
</ul>
<p><strong>✅ Cách tránh:</strong></p>
<ul>
<li><strong>Start Small</strong>: Bắt đầu với 1 service</li>
<li><strong>Measure Everything</strong>: Monitor performance và errors</li>
<li><strong>Train Team</strong>: Invest vào team training</li>
<li><strong>Document Everything</strong>: Maintain good documentation</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-trong-nestjs">gRPC trong NestJS<a href="#grpc-trong-nestjs" class="hash-link" aria-label="Đường dẫn trực tiếp đến gRPC trong NestJS" title="Đường dẫn trực tiếp đến gRPC trong NestJS">​</a></h2>
<p><strong>Lý thuyết về gRPC trong NestJS:</strong>
NestJS cung cấp built-in support cho gRPC thông qua <code>@nestjs/microservices</code> package. Nó cho phép bạn tạo gRPC servers và clients một cách dễ dàng với decorators và dependency injection.</p>
<p><strong>Đặc điểm kỹ thuật:</strong></p>
<ul>
<li><strong>Microservice Transport</strong>: Hỗ trợ gRPC transport</li>
<li><strong>Decorator-based</strong>: Sử dụng <code>@GrpcMethod</code> và <code>@GrpcStreamMethod</code></li>
<li><strong>Dependency Injection</strong>: Tích hợp với NestJS DI container</li>
<li><strong>Observable Support</strong>: Hỗ trợ RxJS Observables cho streaming</li>
</ul>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Transport Configuration</strong>: Cấu hình gRPC transport trong main.ts</li>
<li><strong>Service Registration</strong>: Đăng ký services với gRPC methods</li>
<li><strong>Method Implementation</strong>: Implement các gRPC methods</li>
<li><strong>Client Communication</strong>: Clients gọi methods thông qua gRPC</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Service State</strong>: Unregistered → Registered → Active → Handling Requests</li>
<li><strong>Request State</strong>: gRPC Call → Method Resolution → Service Execution → Response</li>
<li><strong>Transport State</strong>: Disconnected → Connected → Streaming → Idle</li>
</ul>
<p><strong>Ưu điểm:</strong></p>
<ul>
<li><strong>Native Integration</strong>: Tích hợp tốt với NestJS ecosystem</li>
<li><strong>Type Safety</strong>: Generated types từ protobuf</li>
<li><strong>Streaming Support</strong>: Hỗ trợ đầy đủ gRPC streaming</li>
<li><strong>Performance</strong>: High-performance gRPC communication</li>
</ul>
<p><strong>Nhược điểm:</strong></p>
<ul>
<li><strong>Complexity</strong>: Cần hiểu cả NestJS và gRPC</li>
<li><strong>Debugging</strong>: Khó debug gRPC communication</li>
<li><strong>Learning Curve</strong>: Cần học protobuf và gRPC concepts</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-cài-đặt-dependencies">1. <strong>Cài đặt Dependencies</strong><a href="#1-cài-đặt-dependencies" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-cài-đặt-dependencies" title="Đường dẫn trực tiếp đến 1-cài-đặt-dependencies">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-cấu-hình-grpc-server---lý-thuyết-và-thực-hành">2. <strong>Cấu hình gRPC Server - Lý thuyết và Thực hành</strong><a href="#2-cấu-hình-grpc-server---lý-thuyết-và-thực-hành" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-cấu-hình-grpc-server---lý-thuyết-và-thực-hành" title="Đường dẫn trực tiếp đến 2-cấu-hình-grpc-server---lý-thuyết-và-thực-hành">​</a></h3>
<p><strong>Lý thuyết về cấu hình gRPC Server:</strong>
Cấu hình gRPC server trong NestJS liên quan đến việc thiết lập transport layer, định nghĩa proto file path, và cấu hình các options cho gRPC communication.</p>
<p><strong>Đặc điểm kỹ thuật:</strong></p>
<ul>
<li><strong>Transport Type</strong>: Chỉ định gRPC transport</li>
<li><strong>Proto Path</strong>: Đường dẫn đến .proto file</li>
<li><strong>Package Name</strong>: Tên package trong proto definition</li>
<li><strong>Server URL</strong>: Địa chỉ và port của server</li>
<li><strong>Loader Options</strong>: Cấu hình protobuf loader</li>
</ul>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Transport Selection</strong>: Chọn gRPC transport</li>
<li><strong>Proto Loading</strong>: Load proto file từ filesystem</li>
<li><strong>Service Registration</strong>: Đăng ký services từ proto</li>
<li><strong>Server Binding</strong>: Bind server vào specified port</li>
<li><strong>Request Handling</strong>: Xử lý incoming gRPC requests</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Server State</strong>: Uninitialized → Configured → Bound → Listening → Handling Requests</li>
<li><strong>Proto State</strong>: File → Loaded → Parsed → Services Registered</li>
<li><strong>Network State</strong>: Closed → Open → Accepting Connections</li>
</ul>
<p><strong>Ưu điểm:</strong></p>
<ul>
<li><strong>Flexible Configuration</strong>: Nhiều options cấu hình</li>
<li><strong>Proto Integration</strong>: Tích hợp tốt với protobuf</li>
<li><strong>Performance Tuning</strong>: Có thể tune performance options</li>
<li><strong>Development Support</strong>: Hỗ trợ development và production</li>
</ul>
<p><strong>Nhược điểm:</strong></p>
<ul>
<li><strong>Configuration Complexity</strong>: Nhiều options cần cấu hình</li>
<li><strong>Proto Dependency</strong>: Phụ thuộc vào proto file</li>
<li><strong>Error Handling</strong>: Cần xử lý configuration errors</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-service-implementation---lý-thuyết-và-thực-hành">3. <strong>Service Implementation - Lý thuyết và Thực hành</strong><a href="#3-service-implementation---lý-thuyết-và-thực-hành" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3-service-implementation---lý-thuyết-và-thực-hành" title="Đường dẫn trực tiếp đến 3-service-implementation---lý-thuyết-và-thực-hành">​</a></h3>
<p><strong>Lý thuyết về Service Implementation:</strong>
Service implementation trong gRPC sử dụng decorators để map các gRPC methods với service methods. Mỗi gRPC method được implement như một service method với proper error handling và response formatting.</p>
<p><strong>Đặc điểm kỹ thuật:</strong></p>
<ul>
<li><strong>Decorator-based</strong>: Sử dụng <code>@GrpcMethod</code> để map gRPC methods</li>
<li><strong>Streaming Support</strong>: Hỗ trợ server streaming với <code>@GrpcStreamMethod</code></li>
<li><strong>Observable Pattern</strong>: Sử dụng RxJS Observables cho streaming</li>
<li><strong>Error Handling</strong>: Proper error handling và propagation</li>
<li><strong>Type Safety</strong>: Generated types từ protobuf</li>
</ul>
<p><strong>Cách hoạt động:</strong></p>
<ol>
<li><strong>Method Registration</strong>: Decorator đăng ký method với gRPC service</li>
<li><strong>Request Processing</strong>: Nhận và validate incoming requests</li>
<li><strong>Business Logic</strong>: Thực hiện business logic</li>
<li><strong>Response Generation</strong>: Tạo và format response</li>
<li><strong>Streaming</strong>: Xử lý streaming data nếu cần</li>
</ol>
<p><strong>Biến đổi trong quá trình xử lý:</strong></p>
<ul>
<li><strong>Method State</strong>: Unregistered → Registered → Active → Processing → Completed</li>
<li><strong>Request State</strong>: Received → Validated → Processed → Response Generated</li>
<li><strong>Data State</strong>: Raw Request → Validated Data → Business Result → Formatted Response</li>
</ul>
<p><strong>Ưu điểm:</strong></p>
<ul>
<li><strong>Clean Architecture</strong>: Separation of concerns rõ ràng</li>
<li><strong>Type Safety</strong>: Generated types đảm bảo type safety</li>
<li><strong>Streaming Support</strong>: Hỗ trợ đầy đủ gRPC streaming patterns</li>
<li><strong>Error Handling</strong>: Proper error handling và propagation</li>
</ul>
<p><strong>Nhược điểm:</strong></p>
<ul>
<li><strong>Complexity</strong>: Cần hiểu RxJS Observables</li>
<li><strong>Debugging</strong>: Khó debug streaming operations</li>
<li><strong>Memory Management</strong>: Cần quản lý memory cho streaming</li>
<li><strong>Error Propagation</strong>: Complex error handling trong streams</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-grpc-client">4. <strong>gRPC Client</strong><a href="#4-grpc-client" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4-grpc-client" title="Đường dẫn trực tiếp đến 4-grpc-client">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">gRPC Client Configuration</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// user-client.service.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Injectable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OnModuleInit </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@nestjs/common&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ClientGrpc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Transport </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@nestjs/microservices&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> join </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;path&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">UserService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> limit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> search</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">createUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requests</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Injectable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserClientService</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">OnModuleInit</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transport</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Transport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">GRPC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">package</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protoPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;proto/user.proto&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;localhost:5000&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keepCase</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        longs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        enums</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defaults</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        oneofs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> client</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ClientGrpc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> userService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UserService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">onModuleInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-function function" style="color:#d73a49">getService</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">UserService</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> userId </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> limit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> search</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> limit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> search </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> email</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> requests </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requests</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;client&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-communication-patterns">gRPC Communication Patterns<a href="#grpc-communication-patterns" class="hash-link" aria-label="Đường dẫn trực tiếp đến gRPC Communication Patterns" title="Đường dẫn trực tiếp đến gRPC Communication Patterns">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-unary-rpc-request-response">1. <strong>Unary RPC (Request-Response)</strong><a href="#1-unary-rpc-request-response" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-unary-rpc-request-response" title="Đường dẫn trực tiếp đến 1-unary-rpc-request-response">​</a></h3>
<!-- -->
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Unary RPC Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GetUser&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mapToGrpcResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;user123&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;User:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-server-streaming-rpc">2. <strong>Server Streaming RPC</strong><a href="#2-server-streaming-rpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-server-streaming-rpc" title="Đường dẫn trực tiếp đến 2-server-streaming-rpc">​</a></h3>
<!-- -->
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Server Streaming Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GetUsers&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> limit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mapToGrpcResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Received user:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Stream completed&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Stream error:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-client-streaming-rpc">3. <strong>Client Streaming RPC</strong><a href="#3-client-streaming-rpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3-client-streaming-rpc" title="Đường dẫn trực tiếp đến 3-client-streaming-rpc">​</a></h3>
<!-- -->
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Client Streaming Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CreateUsers&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requests</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> userIds</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name builtin">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolve</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userIds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_ids</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> userIds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> total_created</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> userIds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> reject</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;John&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;john@example.com&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;password123&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Jane&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;jane@example.com&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;password456&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> requests </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requests</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Created users:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-bidirectional-streaming-rpc">4. <strong>Bidirectional Streaming RPC</strong><a href="#4-bidirectional-streaming-rpc" class="hash-link" aria-label="Đường dẫn trực tiếp đến 4-bidirectional-streaming-rpc" title="Đường dẫn trực tiếp đến 4-bidirectional-streaming-rpc">​</a></h3>
<!-- -->
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Bidirectional Streaming Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcStreamMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Chat&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> messages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;server&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Echo: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">message</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;client&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Hello!&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;client&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;How are you?&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server response:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Chat completed&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="so-sánh-với-các-protocol-khác">So sánh với các Protocol khác<a href="#so-sánh-với-các-protocol-khác" class="hash-link" aria-label="Đường dẫn trực tiếp đến So sánh với các Protocol khác" title="Đường dẫn trực tiếp đến So sánh với các Protocol khác">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-grpc-vs-rest"><strong>1. gRPC vs REST:</strong><a href="#1-grpc-vs-rest" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-grpc-vs-rest" title="Đường dẫn trực tiếp đến 1-grpc-vs-rest">​</a></h3>
<p><strong>Performance:</strong></p>
<ul>
<li><strong>gRPC</strong>: Binary protocol, HTTP/2, multiplexing, compression</li>
<li><strong>REST</strong>: Text-based, HTTP/1.1, no multiplexing, no compression</li>
<li><strong>Kết quả</strong>: gRPC nhanh hơn 2-10x tùy use case</li>
</ul>
<p><strong>Type Safety:</strong></p>
<ul>
<li><strong>gRPC</strong>: Strong typing, generated code, compile-time validation</li>
<li><strong>REST</strong>: No built-in typing, runtime validation, manual parsing</li>
<li><strong>Kết quả</strong>: gRPC ít bugs hơn, development nhanh hơn</li>
</ul>
<p><strong>Streaming:</strong></p>
<ul>
<li><strong>gRPC</strong>: Bidirectional streaming, real-time communication</li>
<li><strong>REST</strong>: Request-response only, no streaming</li>
<li><strong>Kết quả</strong>: gRPC phù hợp cho real-time apps</li>
</ul>
<p><strong>Browser Support:</strong></p>
<ul>
<li><strong>gRPC</strong>: Limited browser support, mainly server-to-server</li>
<li><strong>REST</strong>: Full browser support, universal compatibility</li>
<li><strong>Kết quả</strong>: REST tốt hơn cho public APIs</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-grpc-vs-graphql"><strong>2. gRPC vs GraphQL:</strong><a href="#2-grpc-vs-graphql" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-grpc-vs-graphql" title="Đường dẫn trực tiếp đến 2-grpc-vs-graphql">​</a></h3>
<p><strong>Data Fetching:</strong></p>
<ul>
<li><strong>gRPC</strong>: Fixed contracts, efficient binary transfer</li>
<li><strong>GraphQL</strong>: Flexible queries, over-fetching prevention</li>
<li><strong>Kết quả</strong>: gRPC tốt cho fixed APIs, GraphQL tốt cho flexible queries</li>
</ul>
<p><strong>Performance:</strong></p>
<ul>
<li><strong>gRPC</strong>: Binary protocol, HTTP/2, high performance</li>
<li><strong>GraphQL</strong>: Text-based, HTTP/1.1, query complexity issues</li>
<li><strong>Kết quả</strong>: gRPC performance tốt hơn cho simple operations</li>
</ul>
<p><strong>Learning Curve:</strong></p>
<ul>
<li><strong>gRPC</strong>: RPC concepts, Protocol Buffers</li>
<li><strong>GraphQL</strong>: Query language, schema design</li>
<li><strong>Kết quả</strong>: Cả hai đều có learning curve cao</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-grpc-vs-message-queues"><strong>3. gRPC vs Message Queues:</strong><a href="#3-grpc-vs-message-queues" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3-grpc-vs-message-queues" title="Đường dẫn trực tiếp đến 3-grpc-vs-message-queues">​</a></h3>
<p><strong>Communication Pattern:</strong></p>
<ul>
<li><strong>gRPC</strong>: Synchronous, request-response, real-time</li>
<li><strong>Message Queues</strong>: Asynchronous, fire-and-forget, eventual consistency</li>
<li><strong>Kết quả</strong>: gRPC cho real-time, MQ cho async processing</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li><strong>gRPC</strong>: Service-to-service calls, real-time communication</li>
<li><strong>Message Queues</strong>: Background jobs, event processing, decoupling</li>
<li><strong>Kết quả</strong>: Khác nhau, không thay thế được nhau</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-best-practices">gRPC Best Practices<a href="#grpc-best-practices" class="hash-link" aria-label="Đường dẫn trực tiếp đến gRPC Best Practices" title="Đường dẫn trực tiếp đến gRPC Best Practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-error-handling">1. <strong>Error Handling</strong><a href="#1-error-handling" class="hash-link" aria-label="Đường dẫn trực tiếp đến 1-error-handling" title="Đường dẫn trực tiếp đến 1-error-handling">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">gRPC Error Handling Best Practice</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ✅ Tốt - Xử lý lỗi với gRPC status codes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GetUser&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOT_FOUND</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;User not found&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        details</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">No user found with ID: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">user_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mapToGrpcResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Failed to get user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// INTERNAL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Internal server error&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Client error handling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;invalid-id&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">code </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOT_FOUND</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;User not found&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">code </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// INTERNAL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-performance-optimization">2. <strong>Performance Optimization</strong><a href="#2-performance-optimization" class="hash-link" aria-label="Đường dẫn trực tiếp đến 2-performance-optimization" title="Đường dẫn trực tiếp đến 2-performance-optimization">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">gRPC Performance Optimization</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ✅ Tốt - Tối ưu performance cho gRPC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Injectable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">OptimizedUserService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> userRepository</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UserRepository</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> cacheService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> CacheService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GetUser&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> user_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check cache first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cachedUser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cacheService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">user_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cachedUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> cachedUser</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Get from database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;User not found&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Cache the result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> grpcResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mapToGrpcResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cacheService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">user_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> grpcResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 5 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> grpcResponse</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">GrpcMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GetUsers&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> limit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Use pagination and streaming</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findAllPaginated</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mapToGrpcResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-connection-management">3. <strong>Connection Management</strong><a href="#3-connection-management" class="hash-link" aria-label="Đường dẫn trực tiếp đến 3-connection-management" title="Đường dẫn trực tiếp đến 3-connection-management">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">gRPC Connection Management</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ✅ Tốt - Quản lý connection hiệu quả</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Injectable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UserClientService</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">OnModuleInit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OnModuleDestroy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> client</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ClientGrpc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> userService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UserService</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ClientProxyFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transport</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Transport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">GRPC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">package</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protoPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;proto/user.proto&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;localhost:5000&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keepCase</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          longs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          enums</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          defaults</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          oneofs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Connection options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxReceiveMessageLength</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 10MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxSendMessageLength</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 10MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keepalive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keepaliveTimeMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 2 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keepaliveTimeoutMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 20 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          keepalivePermitWithoutCalls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          http2MaxPingsWithoutData</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          http2MinTimeBetweenPingsMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 2 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          http2MinPingIntervalWithoutDataMs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 5 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">onModuleInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-function function" style="color:#d73a49">getService</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">UserService</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;UserService&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">onModuleDestroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-vs-rest-comparison">gRPC vs REST Comparison<a href="#grpc-vs-rest-comparison" class="hash-link" aria-label="Đường dẫn trực tiếp đến gRPC vs REST Comparison" title="Đường dẫn trực tiếp đến gRPC vs REST Comparison">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bảng-so-sánh-chi-tiết">Bảng so sánh chi tiết<a href="#bảng-so-sánh-chi-tiết" class="hash-link" aria-label="Đường dẫn trực tiếp đến Bảng so sánh chi tiết" title="Đường dẫn trực tiếp đến Bảng so sánh chi tiết">​</a></h3>
<table><thead><tr><th>Tiêu chí</th><th>gRPC</th><th>REST/HTTP</th></tr></thead><tbody><tr><td><strong>Protocol</strong></td><td>HTTP/2</td><td>HTTP/1.1</td></tr><tr><td><strong>Data Format</strong></td><td>Protocol Buffers (Binary)</td><td>JSON/XML (Text)</td></tr><tr><td><strong>Performance</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td></tr><tr><td><strong>Type Safety</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Streaming</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Browser Support</strong></td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Learning Curve</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Tooling</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Caching</strong></td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Debugging</strong></td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-recommendations">Use Case Recommendations<a href="#use-case-recommendations" class="hash-link" aria-label="Đường dẫn trực tiếp đến Use Case Recommendations" title="Đường dẫn trực tiếp đến Use Case Recommendations">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Protocol Selection Guidelines</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ProtocolSelection</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ Dùng gRPC cho:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - High-performance APIs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Service-to-service communication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Real-time streaming</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Strong typing requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Internal microservices</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ Dùng REST cho:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Public APIs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Browser clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Simple CRUD operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Third-party integrations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// - Caching requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>💡 Lời khuyên tổng kết</div><div class="admonitionContent_BuS1"><ul>
<li>Sử dụng gRPC cho high-performance, service-to-service communication</li>
<li>Protocol Buffers cung cấp type safety và hiệu suất cao</li>
<li>Implement proper error handling với gRPC status codes</li>
<li>Optimize performance với connection pooling và caching</li>
<li>Chọn protocol phù hợp với use case cụ thể</li>
<li>Monitor và optimize gRPC performance metrics</li>
</ul></div></div>
<p><strong>Bài tiếp theo:</strong> <a href="/document/docs/microservices/communication/rest-protocol">REST Protocol</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ecom-co/document/tree/main/docs/microservices/communication/grpc-protocol.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Sửa trang này</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Trang tài liệu"><a class="pagination-nav__link pagination-nav__link--prev" href="/document/docs/microservices/communication/communication-overview"><div class="pagination-nav__sublabel">Trước</div><div class="pagination-nav__label">Communication Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/document/docs/microservices/communication/rest-protocol"><div class="pagination-nav__sublabel">Kế tiếp</div><div class="pagination-nav__label">REST Protocol</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#grpc-là-gì" class="table-of-contents__link toc-highlight">gRPC là gì?</a></li><li><a href="#khi-nào-nên-dùng-và-khi-nào-không-nên-dùng-grpc" class="table-of-contents__link toc-highlight">Khi nào nên dùng và khi nào không nên dùng gRPC</a><ul><li><a href="#khi-nào-nên-dùng-grpc" class="table-of-contents__link toc-highlight"><strong>Khi nào NÊN dùng gRPC:</strong></a></li><li><a href="#khi-nào-không-nên-dùng-grpc" class="table-of-contents__link toc-highlight"><strong>Khi nào KHÔNG NÊN dùng gRPC:</strong></a></li><li><a href="#giải-thích-chi-tiết-về-vấn-đề-file-upload" class="table-of-contents__link toc-highlight"><strong>Giải thích chi tiết về vấn đề File Upload:</strong></a></li><li><a href="#các-vấn-đề-kỹ-thuật-khác" class="table-of-contents__link toc-highlight"><strong>Các vấn đề kỹ thuật khác:</strong></a></li></ul></li><li><a href="#kiến-trúc-grpc" class="table-of-contents__link toc-highlight">Kiến trúc gRPC</a><ul><li><a href="#1-grpc-flow---lý-thuyết-và-quy-trình" class="table-of-contents__link toc-highlight">1. <strong>gRPC Flow - Lý thuyết và Quy trình</strong></a></li><li><a href="#2-protocol-buffers---lý-thuyết-và-cấu-trúc" class="table-of-contents__link toc-highlight">2. <strong>Protocol Buffers - Lý thuyết và Cấu trúc</strong></a></li></ul></li><li><a href="#cách-áp-dụng-grpc-hiệu-quả" class="table-of-contents__link toc-highlight">Cách áp dụng gRPC hiệu quả</a><ul><li><a href="#1-chiến-lược-áp-dụng-adoption-strategy" class="table-of-contents__link toc-highlight"><strong>1. Chiến lược áp dụng (Adoption Strategy):</strong></a></li><li><a href="#2-best-practices-khi-áp-dụng" class="table-of-contents__link toc-highlight"><strong>2. Best Practices khi áp dụng:</strong></a></li><li><a href="#3-common-pitfalls-và-cách-tránh" class="table-of-contents__link toc-highlight"><strong>3. Common Pitfalls và cách tránh:</strong></a></li></ul></li><li><a href="#grpc-trong-nestjs" class="table-of-contents__link toc-highlight">gRPC trong NestJS</a><ul><li><a href="#1-cài-đặt-dependencies" class="table-of-contents__link toc-highlight">1. <strong>Cài đặt Dependencies</strong></a></li><li><a href="#2-cấu-hình-grpc-server---lý-thuyết-và-thực-hành" class="table-of-contents__link toc-highlight">2. <strong>Cấu hình gRPC Server - Lý thuyết và Thực hành</strong></a></li><li><a href="#3-service-implementation---lý-thuyết-và-thực-hành" class="table-of-contents__link toc-highlight">3. <strong>Service Implementation - Lý thuyết và Thực hành</strong></a></li><li><a href="#4-grpc-client" class="table-of-contents__link toc-highlight">4. <strong>gRPC Client</strong></a></li></ul></li><li><a href="#grpc-communication-patterns" class="table-of-contents__link toc-highlight">gRPC Communication Patterns</a><ul><li><a href="#1-unary-rpc-request-response" class="table-of-contents__link toc-highlight">1. <strong>Unary RPC (Request-Response)</strong></a></li><li><a href="#2-server-streaming-rpc" class="table-of-contents__link toc-highlight">2. <strong>Server Streaming RPC</strong></a></li><li><a href="#3-client-streaming-rpc" class="table-of-contents__link toc-highlight">3. <strong>Client Streaming RPC</strong></a></li><li><a href="#4-bidirectional-streaming-rpc" class="table-of-contents__link toc-highlight">4. <strong>Bidirectional Streaming RPC</strong></a></li></ul></li><li><a href="#so-sánh-với-các-protocol-khác" class="table-of-contents__link toc-highlight">So sánh với các Protocol khác</a><ul><li><a href="#1-grpc-vs-rest" class="table-of-contents__link toc-highlight"><strong>1. gRPC vs REST:</strong></a></li><li><a href="#2-grpc-vs-graphql" class="table-of-contents__link toc-highlight"><strong>2. gRPC vs GraphQL:</strong></a></li><li><a href="#3-grpc-vs-message-queues" class="table-of-contents__link toc-highlight"><strong>3. gRPC vs Message Queues:</strong></a></li></ul></li><li><a href="#grpc-best-practices" class="table-of-contents__link toc-highlight">gRPC Best Practices</a><ul><li><a href="#1-error-handling" class="table-of-contents__link toc-highlight">1. <strong>Error Handling</strong></a></li><li><a href="#2-performance-optimization" class="table-of-contents__link toc-highlight">2. <strong>Performance Optimization</strong></a></li><li><a href="#3-connection-management" class="table-of-contents__link toc-highlight">3. <strong>Connection Management</strong></a></li></ul></li><li><a href="#grpc-vs-rest-comparison" class="table-of-contents__link toc-highlight">gRPC vs REST Comparison</a><ul><li><a href="#bảng-so-sánh-chi-tiết" class="table-of-contents__link toc-highlight">Bảng so sánh chi tiết</a></li><li><a href="#use-case-recommendations" class="table-of-contents__link toc-highlight">Use Case Recommendations</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>