---
title: Modules
description: T√¨m hi·ªÉu v·ªÅ Modules - c√°ch NestJS t·ªï ch·ª©c v√† c·∫•u tr√∫c ·ª©ng d·ª•ng
---

# Modules

Modules l√† c√°ch NestJS t·ªï ch·ª©c ·ª©ng d·ª•ng th√†nh c√°c ph·∫ßn ri√™ng bi·ªát v√† c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng. Ch√∫ng ƒë√≥ng vai tr√≤ nh∆∞ container ch·ª©a c√°c controllers, services v√† providers li√™n quan.

```mermaid
graph LR
    A[AppModule] --> B[UserModule]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
```

```mermaid
graph LR
    B[UserModule] --> C[UserController]
    B --> D[UserService]
    B --> E[UserRepository]
    
    style B fill:#f3e5f5
    style C fill:#fce4ec
    style D fill:#f1f8e9
    style E fill:#fff8e1
```

:::tip üí° Kh√°i ni·ªám c∆° b·∫£n
Modules trong NestJS gi·ªëng nh∆∞ c√°c "h·ªôp" ch·ª©a c√°c th√†nh ph·∫ßn li√™n quan. M·ªói h·ªôp c√≥ th·ªÉ ch·ª©a controllers, services v√† c√≥ th·ªÉ chia s·∫ª v·ªõi c√°c h·ªôp kh√°c.
:::

## Modules l√† g√¨?

Modules trong NestJS:
- **T·ªï ch·ª©c code** - chia nh·ªè ·ª©ng d·ª•ng th√†nh c√°c ph·∫ßn logic
- **Qu·∫£n l√Ω dependencies** - ki·ªÉm so√°t vi·ªác import/export providers
- **Encapsulation** - ·∫©n implementation details
- **Reusability** - t√°i s·ª≠ d·ª•ng logic ·ªü nhi·ªÅu n∆°i
- **Testing** - d·ªÖ d√†ng test t·ª´ng module ƒë·ªôc l·∫≠p

## L√Ω thuy·∫øt v·ªÅ Modules

### Nguy√™n l√Ω ho·∫°t ƒë·ªông

Modules trong NestJS ho·∫°t ƒë·ªông d·ª±a tr√™n nguy√™n l√Ω **Dependency Injection Container**:

1. **Registration** - ƒêƒÉng k√Ω providers trong module
2. **Resolution** - T·ª± ƒë·ªông resolve dependencies
3. **Lifecycle Management** - Qu·∫£n l√Ω v√≤ng ƒë·ªùi c·ªßa providers
4. **Scoping** - Ki·ªÉm so√°t ph·∫°m vi c·ªßa providers

:::info üîß Dependency Injection Container
DI Container l√† "b·ªô n√£o" c·ªßa NestJS, t·ª± ƒë·ªông qu·∫£n l√Ω vi·ªác t·∫°o v√† k·∫øt n·ªëi c√°c dependencies gi·ªØa c√°c th√†nh ph·∫ßn.
:::

### Module Metadata

M·ªói module ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng metadata:

```typescript title="Module Metadata Structure"
@Module({
  // highlight-start
  imports: [],      // Modules kh√°c c·∫ßn import
  controllers: [],  // Controllers c·ªßa module n√†y
  providers: [],    // Services v√† providers
  exports: [],      // Providers ƒë·ªÉ export cho modules kh√°c
  // highlight-end
})
```

## T·∫°o Module c∆° b·∫£n

```typescript title="Basic Module Example"
import { Module } from '@nestjs/common';
import { UserController } from './user.controller';
import { UserService } from './user.service';

@Module({
  // highlight-start
  imports: [],
  controllers: [UserController],
  providers: [UserService],
  exports: [UserService],
  // highlight-end
})
export class UserModule {}
```

## C·∫•u tr√∫c Module

M·ªói module c√≥ 4 ph·∫ßn ch√≠nh:

```mermaid
graph LR
    A[Module] --> B[imports]
    A --> C[controllers]
    A --> D[providers]
    A --> E[exports]
    
    B --> F[Import Modules]
    C --> G[HTTP Controllers]
    D --> H[Services & Providers]
    E --> I[Export Providers]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
```

```typescript title="Module Structure Breakdown"
@Module({
  imports: [],      // Import modules kh√°c
  controllers: [],  // Controllers c·ªßa module
  providers: [],    // Services v√† providers
  exports: [],      // Export cho modules kh√°c
})
export class ExampleModule {}
```

### Imports
- Import c√°c modules kh√°c
- S·ª≠ d·ª•ng providers t·ª´ modules ƒë√£ import

### Controllers
- X·ª≠ l√Ω HTTP requests
- ƒê·ªãnh nghƒ©a routes

### Providers
- Services, repositories, factories
- Logic nghi·ªáp v·ª•

### Exports
- Chia s·∫ª providers v·ªõi modules kh√°c
- Ch·ªâ export nh·ªØng g√¨ c·∫ßn thi·∫øt

## C√°c lo·∫°i Modules

```mermaid
graph LR
    A[Module Types] --> B[AppModule]
    A --> C[Feature Modules]
    A --> D[Shared Modules]
    A --> E[Global Modules]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
```

### 1. AppModule (Module g·ªëc)

**ƒê·ªãnh nghƒ©a:** AppModule l√† module ch√≠nh v√† duy nh·∫•t c·ªßa ·ª©ng d·ª•ng NestJS. ƒê√¢y l√† ƒëi·ªÉm kh·ªüi ƒë·∫ßu c·ªßa ·ª©ng d·ª•ng.

**Vai tr√≤:**
- Module ch√≠nh c·ªßa ·ª©ng d·ª•ng
- Import t·∫•t c·∫£ c√°c modules kh√°c
- C·∫•u h√¨nh global providers
- ƒêi·ªÉm entry c·ªßa ·ª©ng d·ª•ng

**Khi n√†o s·ª≠ d·ª•ng:**
- Lu√¥n c·∫ßn thi·∫øt trong m·ªçi ·ª©ng d·ª•ng NestJS
- Ch·ªâ c√≥ m·ªôt AppModule duy nh·∫•t
- ƒê∆∞·ª£c bootstrap trong main.ts

```typescript title="AppModule Example"
@Module({
  imports: [
    UserModule,
    ProductModule,
    OrderModule,
    AuthModule,
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

:::warning ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng
- AppModule kh√¥ng n√™n ch·ª©a business logic
- Ch·ªâ n√™n import c√°c modules kh√°c
- C√≥ th·ªÉ c√≥ m·ªôt s·ªë global providers c·∫ßn thi·∫øt
:::

```mermaid
graph LR
    A[AppModule] --> B[UserModule]
    A --> C[ProductModule]
    A --> D[OrderModule]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
```

### 2. Feature Modules

**ƒê·ªãnh nghƒ©a:** Feature Modules l√† c√°c module ch·ª©a logic cho m·ªôt t√≠nh nƒÉng c·ª• th·ªÉ c·ªßa ·ª©ng d·ª•ng. M·ªói t√≠nh nƒÉng s·∫Ω c√≥ m·ªôt module ri√™ng.

**Vai tr√≤:**
- T·ªï ch·ª©c code theo t√≠nh nƒÉng
- Encapsulation logic li√™n quan
- D·ªÖ d√†ng maintain v√† test
- C√≥ th·ªÉ t√°i s·ª≠ d·ª•ng

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c√≥ logic nghi·ªáp v·ª• ph·ª©c t·∫°p
- Khi c·∫ßn t√°ch bi·ªát c√°c t√≠nh nƒÉng
- Khi mu·ªën code d·ªÖ maintain
- Khi c·∫ßn t√°i s·ª≠ d·ª•ng logic

```typescript title="Feature Module Example"
@Module({
  controllers: [UserController],
  providers: [UserService, UserRepository],
  exports: [UserService],
})
export class UserModule {}
```

**V√≠ d·ª• c√°c Feature Modules:**
- **UserModule** - qu·∫£n l√Ω ng∆∞·ªùi d√πng, authentication, authorization
- **ProductModule** - qu·∫£n l√Ω s·∫£n ph·∫©m, categories, inventory
- **OrderModule** - qu·∫£n l√Ω ƒë∆°n h√†ng, payments, shipping
- **AuthModule** - x√°c th·ª±c, JWT, OAuth, permissions

:::tip üéØ L·ª£i √≠ch c·ªßa Feature Modules
- **Separation of Concerns** - t√°ch bi·ªát c√°c m·ªëi quan t√¢m
- **Maintainability** - d·ªÖ b·∫£o tr√¨ v√† c·∫≠p nh·∫≠t
- **Testability** - d·ªÖ test t·ª´ng t√≠nh nƒÉng
- **Reusability** - c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng ·ªü d·ª± √°n kh√°c
:::

### 3. Shared Modules

**ƒê·ªãnh nghƒ©a:** Shared Modules l√† c√°c module ch·ª©a logic chung ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi nhi·ªÅu modules kh√°c. Ch√∫ng export c√°c providers ƒë·ªÉ modules kh√°c c√≥ th·ªÉ s·ª≠ d·ª•ng.

**Vai tr√≤:**
- Chia s·∫ª logic chung
- Tr√°nh duplicate code
- Cung c·∫•p utilities v√† helpers
- T√°i s·ª≠ d·ª•ng providers

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c√≥ logic ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü nhi·ªÅu n∆°i
- Khi mu·ªën tr√°nh duplicate code
- Khi c·∫ßn utilities chung
- Khi c·∫ßn database connections, logging, config

```typescript title="Shared Module Example"
@Module({
  providers: [DatabaseService, LoggerService],
  exports: [DatabaseService, LoggerService],
})
export class SharedModule {}
```

```mermaid
graph LR
    A[Shared Modules] --> B[DatabaseModule]
    A --> C[LoggerModule]
    A --> D[ConfigModule]
    A --> E[CacheModule]
    
    B --> F[Database Service]
    C --> G[Logger Service]
    D --> H[Config Service]
    E --> I[Cache Service]
    
    style A fill:#fff3e0
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fce4ec
    style E fill:#f1f8e9
    style F fill:#f9fbe7
    style G fill:#fff8e1
    style H fill:#e1f5fe
    style I fill:#f3e5f5
```

**V√≠ d·ª• c√°c Shared Modules:**
- **DatabaseModule** - k·∫øt n·ªëi database, repositories
- **LoggerModule** - logging, error handling
- **ConfigModule** - configuration, environment variables
- **CacheModule** - caching, Redis connections

:::info üîÑ L·ª£i √≠ch c·ªßa Shared Modules
- **DRY Principle** - Don't Repeat Yourself
- **Consistency** - ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n
- **Maintainability** - d·ªÖ maintain khi thay ƒë·ªïi logic chung
- **Performance** - t·ªëi ∆∞u performance v·ªõi shared resources
:::

### 4. Global Modules

**ƒê·ªãnh nghƒ©a:** Global Modules l√† c√°c module c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü m·ªçi n∆°i trong ·ª©ng d·ª•ng m√† kh√¥ng c·∫ßn import v√†o t·ª´ng module.

**Vai tr√≤:**
- Cung c·∫•p utilities to√†n c·ª•c
- Kh√¥ng c·∫ßn import ·ªü m·ªçi module
- T·ª± ƒë·ªông c√≥ s·∫µn trong to√†n b·ªô ·ª©ng d·ª•ng
- Gi·∫£m boilerplate code

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c·∫ßn utilities ·ªü m·ªçi n∆°i
- Khi mu·ªën gi·∫£m boilerplate import
- Khi c√≥ configuration to√†n c·ª•c
- Khi c√≥ logging, error handling to√†n c·ª•c

```typescript title="Global Module Example"
@Global()
@Module({
  providers: [ConfigService],
  exports: [ConfigService],
})
export class ConfigModule {}
```

```mermaid
graph LR
    A[Global Modules] --> B[ConfigModule]
    A --> C[LoggerModule]
    A --> D[ExceptionFilterModule]
    A --> E[ValidationModule]
    
    B --> F[App Config]
    C --> G[App Logger]
    D --> H[Error Handler]
    E --> I[Validators]
    
    style A fill:#fce4ec
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#f1f8e9
    style F fill:#f9fbe7
    style G fill:#fff8e1
    style H fill:#e1f5fe
    style I fill:#f3e5f5
```

**V√≠ d·ª• c√°c Global Modules:**
- **ConfigModule** - configuration to√†n c·ª•c
- **LoggerModule** - logging to√†n c·ª•c
- **ExceptionFilterModule** - error handling to√†n c·ª•c
- **ValidationModule** - validation to√†n c·ª•c

:::warning ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng v·ªÅ Global Modules
- Ch·ªâ s·ª≠ d·ª•ng `@Global()` khi th·ª±c s·ª± c·∫ßn thi·∫øt
- Global modules c√≥ th·ªÉ g√¢y kh√≥ khƒÉn cho testing
- C√≥ th·ªÉ g√¢y circular dependencies
- N√™n s·ª≠ d·ª•ng c√≥ ch·ªçn l·ªçc
:::

## Module Configuration

### Dynamic Modules

**ƒê·ªãnh nghƒ©a:** Dynamic Modules l√† c√°c module c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªông khi import. Ch√∫ng s·ª≠ d·ª•ng static methods ƒë·ªÉ t·∫°o module v·ªõi configuration t√πy ch·ªânh.

**Vai tr√≤:**
- C·∫•u h√¨nh module linh ho·∫°t
- T√πy ch·ªânh providers d·ª±a tr√™n options
- T·∫°o module v·ªõi configuration kh√°c nhau
- Reusable modules v·ªõi configuration

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi module c·∫ßn configuration
- Khi mu·ªën module linh ho·∫°t
- Khi c·∫ßn t√πy ch·ªânh providers
- Khi t·∫°o reusable modules

#### forRoot() Method

**ƒê·ªãnh nghƒ©a:** `forRoot()` l√† static method ph·ªï bi·∫øn nh·∫•t ƒë·ªÉ c·∫•u h√¨nh Dynamic Modules. N√≥ nh·∫≠n configuration options v√† tr·∫£ v·ªÅ DynamicModule.

**C√°ch ho·∫°t ƒë·ªông:**
- Nh·∫≠n configuration options l√†m parameter
- T·∫°o providers d·ª±a tr√™n options
- Tr·∫£ v·ªÅ DynamicModule v·ªõi providers ƒë√£ c·∫•u h√¨nh
- Th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü AppModule level

```typescript title="forRoot() Method Implementation"
@Module({})
export class DatabaseModule {
  // highlight-next-line
  static forRoot(options: DatabaseOptions): DynamicModule {
    return {
      module: DatabaseModule,
      // highlight-start
      providers: [
        {
          provide: 'DATABASE_OPTIONS',
          useValue: options,
        },
        DatabaseService,
      ],
      // highlight-end
      exports: [DatabaseService],
    };
  }
}

```typescript title="forRoot() Usage Example"
// Usage
@Module({
  imports: [
    DatabaseModule.forRoot({
      host: 'localhost',
      port: 5432,
      database: 'myapp',
    }),
  ],
})
export class AppModule {}
```

:::info üîß forRoot() Pattern
- **Configuration** - nh·∫≠n options ƒë·ªÉ c·∫•u h√¨nh module
- **Provider Registration** - ƒëƒÉng k√Ω providers d·ª±a tr√™n config
- **Global Setup** - th∆∞·ªùng ƒë∆∞·ª£c g·ªçi ·ªü AppModule
- **Single Instance** - t·∫°o m·ªôt instance duy nh·∫•t cho to√†n b·ªô app
:::

#### forRootAsync() Method

**ƒê·ªãnh nghƒ©a:** `forRootAsync()` l√† static method ƒë·ªÉ c·∫•u h√¨nh Dynamic Modules v·ªõi async operations. N√≥ s·ª≠ d·ª•ng factories ƒë·ªÉ t·∫°o providers b·∫•t ƒë·ªìng b·ªô.

**C√°ch ho·∫°t ƒë·ªông:**
- Nh·∫≠n async factory function
- S·ª≠ d·ª•ng `useFactory` ƒë·ªÉ t·∫°o providers
- C√≥ th·ªÉ inject dependencies t·ª´ modules kh√°c
- H·ªó tr·ª£ async configuration loading

```typescript title="forRootAsync() Method Implementation"
@Module({})
export class ConfigModule {
  // highlight-next-line
  static forRootAsync(options: ConfigModuleAsyncOptions): DynamicModule {
    return {
      module: ConfigModule,
      imports: options.imports || [],
      // highlight-start
      providers: [
        {
          provide: 'CONFIG_OPTIONS',
          useFactory: options.useFactory,
          inject: options.inject || [],
        },
        ConfigService,
      ],
      // highlight-end
      exports: [ConfigService],
    };
  }
}
```

```typescript title="forRootAsync() Usage Example"
// Usage v·ªõi async factory
@Module({
  imports: [
    ConfigModule.forRootAsync({
      imports: [HttpModule],
      useFactory: async (httpService: HttpService) => {
        const response = await httpService.get('/api/config').toPromise();
        return response.data;
      },
      inject: [HttpService],
    }),
  ],
})
export class AppModule {}
```

:::info üîÑ forRootAsync() Pattern
- **Async Configuration** - load config t·ª´ external sources
- **Dependency Injection** - c√≥ th·ªÉ inject services t·ª´ modules kh√°c
- **Factory Pattern** - s·ª≠ d·ª•ng factory function ƒë·ªÉ t·∫°o config
- **Flexible Setup** - linh ho·∫°t trong vi·ªác setup configuration
:::

#### So s√°nh forRoot() vs forRootAsync()

```mermaid
graph TB
    A[Dynamic Module Methods] --> B[forRoot]
    A --> C[forRootAsync]
    
    B --> D[Static Configuration]
    B --> E[Simple Setup]
    B --> F[No Dependencies]
    
    C --> G[Async Configuration]
    C --> H[Factory Pattern]
    C --> I[Can Inject Dependencies]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
```

| Aspect | forRoot() | forRootAsync() |
|--------|-----------|----------------|
| **Configuration** | Static options | Async factory |
| **Dependencies** | Kh√¥ng th·ªÉ inject | C√≥ th·ªÉ inject t·ª´ modules kh√°c |
| **Use Case** | Simple configuration | Complex async setup |
| **Performance** | Synchronous | Asynchronous |
| **Complexity** | ƒê∆°n gi·∫£n | Ph·ª©c t·∫°p h∆°n |

:::tip üéØ L·ª£i √≠ch c·ªßa Dynamic Modules
- **Flexibility** - linh ho·∫°t trong c·∫•u h√¨nh
- **Reusability** - t√°i s·ª≠ d·ª•ng v·ªõi config kh√°c nhau
- **Type Safety** - type-safe configuration
- **Testing** - d·ªÖ test v·ªõi config kh√°c nhau
:::

### Async Modules

**ƒê·ªãnh nghƒ©a:** Async Modules l√† c√°c module c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh b·∫•t ƒë·ªìng b·ªô. Ch√∫ng s·ª≠ d·ª•ng factories ƒë·ªÉ t·∫°o providers v·ªõi async operations.

**Vai tr√≤:**
- C·∫•u h√¨nh module b·∫•t ƒë·ªìng b·ªô
- Load configuration t·ª´ external sources
- Initialize providers v·ªõi async operations
- Dynamic configuration loading

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c·∫ßn load config t·ª´ file/database
- Khi c·∫ßn async initialization
- Khi c·∫ßn dynamic configuration
- Khi c·∫ßn environment-specific config

```typescript title="Async Module Example"
@Module({})
export class ConfigModule {
  static forRootAsync(options: ConfigModuleAsyncOptions): DynamicModule {
    return {
      module: ConfigModule,
      imports: options.imports || [],
      providers: [
        {
          provide: 'CONFIG_OPTIONS',
          useFactory: options.useFactory,
          inject: options.inject || [],
        },
        ConfigService,
      ],
      exports: [ConfigService],
    };
  }
}
```

## Module Dependencies

### Circular Dependencies

**ƒê·ªãnh nghƒ©a:** Circular Dependencies x·∫£y ra khi hai modules ph·ª• thu·ªôc l·∫´n nhau. ƒêi·ªÅu n√†y c√≥ th·ªÉ g√¢y ra l·ªói trong qu√° tr√¨nh bootstrap.

**V·∫•n ƒë·ªÅ:**
- G√¢y l·ªói khi bootstrap
- Kh√≥ maintain v√† debug
- C√≥ th·ªÉ g√¢y memory leaks
- Kh√≥ test

**Gi·∫£i ph√°p:**
- S·ª≠ d·ª•ng `forwardRef()`
- Refactor code ƒë·ªÉ tr√°nh circular dependencies
- S·ª≠ d·ª•ng events ho·∫∑c message passing
- T√°ch logic chung ra shared module

```mermaid
graph LR
    A[UserModule] -.->|forwardRef| B[OrderModule]
    B -.->|forwardRef| A
    
    style A fill:#f3e5f5
    style B fill:#e8f5e8
```

```typescript title="Circular Dependencies with forwardRef()"
// UserModule
@Module({
  // highlight-start
  imports: [forwardRef(() => OrderModule)],
  // highlight-end
  exports: [UserService],
})
export class UserModule {}

// OrderModule
@Module({
  // highlight-start
  imports: [forwardRef(() => UserModule)],
  // highlight-end
  exports: [OrderService],
})
export class OrderModule {}
```

:::warning ‚ö†Ô∏è Circular Dependencies
Circular dependencies l√† m·ªôt v·∫•n ƒë·ªÅ ph·ª©c t·∫°p. Lu√¥n c·ªë g·∫Øng thi·∫øt k·∫ø ki·∫øn tr√∫c ƒë·ªÉ tr√°nh ch√∫ng, ch·ªâ s·ª≠ d·ª•ng `forwardRef()` khi th·ª±c s·ª± c·∫ßn thi·∫øt.
:::

### Gi·∫£i ph√°p cho Circular Dependencies

#### 1. S·ª≠ d·ª•ng forwardRef()
```typescript title="forwardRef Solution"
// UserModule
@Module({
  imports: [forwardRef(() => OrderModule)],
  exports: [UserService],
})
export class UserModule {}

// OrderModule
@Module({
  imports: [forwardRef(() => UserModule)],
  exports: [OrderService],
})
export class OrderModule {}
```

#### 2. Refactor Architecture
```mermaid
graph LR
    A[UserModule] --> C[SharedModule]
    B[OrderModule] --> C
    
    style A fill:#f3e5f5
    style B fill:#e8f5e8
    style C fill:#fff3e0
```

```typescript title="Refactored Architecture"
// SharedModule - gi·∫£i quy·∫øt circular dependency
@Module({
  providers: [UserOrderService, CommonUtils],
  exports: [UserOrderService, CommonUtils],
})
export class SharedModule {}

// UserModule
@Module({
  imports: [SharedModule],
  exports: [UserService],
})
export class UserModule {}

// OrderModule
@Module({
  imports: [SharedModule],
  exports: [OrderService],
})
export class OrderModule {}
```

#### 3. Event-based Communication
```mermaid
graph LR
    A[UserModule] --> C[EventBus]
    B[OrderModule] --> C
    
    style A fill:#f3e5f5
    style B fill:#e8f5e8
    style C fill:#fff3e0
```

```typescript title="Event-based Solution"
// UserModule
@Module({
  providers: [UserService, UserEvents],
  exports: [UserService],
})
export class UserModule {}

// OrderModule
@Module({
  providers: [OrderService, OrderEvents],
  exports: [OrderService],
})
export class OrderModule {}

// S·ª≠ d·ª•ng events thay v√¨ direct imports
@Injectable()
export class UserService {
  constructor(private eventBus: EventBus) {}

  createUser(dto: CreateUserDto) {
    // T·∫°o user
    const user = this.userRepository.create(dto);
    
    // Emit event thay v√¨ g·ªçi tr·ª±c ti·∫øp OrderService
    this.eventBus.emit('user.created', user);
    
    return user;
  }
}
```

### Conditional Imports

**ƒê·ªãnh nghƒ©a:** Conditional Imports cho ph√©p import modules d·ª±a tr√™n ƒëi·ªÅu ki·ªán nh∆∞ environment, configuration, ho·∫∑c runtime conditions.

**Vai tr√≤:**
- Import modules theo environment
- Dynamic module loading
- Feature flags
- Environment-specific modules

```typescript title="Conditional Module Imports"
@Module({
  imports: [
    process.env.NODE_ENV === 'production' 
      ? ProductionModule 
      : DevelopmentModule,
  ],
})
export class AppModule {}
```

## Module Scopes

### Default Scope (Singleton)

**ƒê·ªãnh nghƒ©a:** M·∫∑c ƒë·ªãnh, t·∫•t c·∫£ providers trong NestJS ƒë·ªÅu c√≥ scope l√† singleton. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ch·ªâ c√≥ m·ªôt instance duy nh·∫•t cho to√†n b·ªô ·ª©ng d·ª•ng.

**ƒê·∫∑c ƒëi·ªÉm:**
- M·ªôt instance duy nh·∫•t
- Shared state across requests
- Memory efficient
- Kh√¥ng thread-safe

```typescript title="Singleton Scope (Default)"
@Injectable()
export class UserService {
  // M·ªôt instance duy nh·∫•t cho to√†n b·ªô ·ª©ng d·ª•ng
}
```

### Request Scope

**ƒê·ªãnh nghƒ©a:** Request Scope t·∫°o ra m·ªôt instance m·ªõi cho m·ªói HTTP request. M·ªói request s·∫Ω c√≥ instance ri√™ng c·ªßa provider.

**ƒê·∫∑c ƒëi·ªÉm:**
- Instance m·ªõi cho m·ªói request
- Isolated state per request
- Thread-safe
- Memory overhead

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c·∫ßn isolated state per request
- Khi c·∫ßn request-specific data
- Khi c·∫ßn thread safety
- Khi c·∫ßn user-specific context

```typescript title="Request Scope Example"
@Injectable({ 
  // highlight-next-line
  scope: Scope.REQUEST 
})
export class UserService {
  // M·ªôt instance m·ªõi cho m·ªói request
}
```

### Transient Scope

**ƒê·ªãnh nghƒ©a:** Transient Scope t·∫°o ra m·ªôt instance m·ªõi m·ªói l·∫ßn provider ƒë∆∞·ª£c inject. M·ªói injection s·∫Ω c√≥ instance ri√™ng.

**ƒê·∫∑c ƒëi·ªÉm:**
- Instance m·ªõi m·ªói l·∫ßn inject
- No shared state
- Memory overhead
- Complete isolation

**Khi n√†o s·ª≠ d·ª•ng:**
- Khi c·∫ßn complete isolation
- Khi kh√¥ng mu·ªën shared state
- Khi c·∫ßn fresh instance m·ªói l·∫ßn
- Khi c·∫ßn temporary objects

```typescript title="Transient Scope Example"
@Injectable({ 
  // highlight-next-line
  scope: Scope.TRANSIENT 
})
export class UserService {
  // M·ªôt instance m·ªõi m·ªói l·∫ßn inject
}
```

:::info üìä So s√°nh c√°c Scopes
| Scope | Instance | Memory | Thread-safe | Use Case |
|-------|----------|--------|-------------|----------|
| Singleton | 1 | Low | No | Shared state |
| Request | Per request | Medium | Yes | Request isolation |
| Transient | Per injection | High | Yes | Complete isolation |
:::

```mermaid
graph LR
    A[Module Scopes] --> B[Singleton]
    A --> C[Request]
    A --> D[Transient]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fce4ec
```

```mermaid
graph LR
    B[Singleton] --> E[1 Instance cho to√†n app]
    B --> F[Shared State]
    B --> G[Memory Efficient]
    
    C[Request] --> H[1 Instance cho m·ªói request]
    C --> I[Isolated State]
    C --> J[Thread Safe]
    
    D[Transient] --> K[1 Instance cho m·ªói injection]
    D --> L[No Shared State]
    D --> M[Complete Isolation]
    
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fce4ec
    style E fill:#f1f8e9
    style F fill:#fff8e1
    style G fill:#f3e5f5
    style H fill:#e1f5fe
    style I fill:#f9fbe7
    style J fill:#e8f5e8
    style K fill:#fce4ec
    style L fill:#ffebee
    style M fill:#fff3e0
```

## Module Testing

### Unit Testing

**M·ª•c ƒë√≠ch:** Test t·ª´ng module ƒë·ªôc l·∫≠p ƒë·ªÉ ƒë·∫£m b·∫£o module ho·∫°t ƒë·ªông ƒë√∫ng.

**Ph∆∞∆°ng ph√°p:**
- Test module configuration
- Test providers registration
- Test exports
- Mock dependencies

```typescript title="Module Unit Testing"
describe('UserModule', () => {
  let module: TestingModule;

  beforeEach(async () => {
    // highlight-start
    module = await Test.createTestingModule({
      imports: [UserModule],
    }).compile();
    // highlight-end
  });

  it('should be defined', () => {
    expect(module).toBeDefined();
  });

  it('should have UserService', () => {
    // highlight-next-line
    const userService = module.get<UserService>(UserService);
    expect(userService).toBeDefined();
  });
});
```

### Integration Testing

**M·ª•c ƒë√≠ch:** Test module trong context c·ªßa ·ª©ng d·ª•ng ho√†n ch·ªânh.

**Ph∆∞∆°ng ph√°p:**
- Test v·ªõi real dependencies
- Test HTTP endpoints
- Test database operations
- Test error scenarios

```typescript title="Module Integration Testing"
describe('UserModule Integration', () => {
  let app: INestApplication;

  beforeEach(async () => {
    const moduleFixture = await Test.createTestingModule({
      imports: [UserModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  afterEach(async () => {
    await app.close();
  });
});
```

## Best Practices

### 1. T·ªï ch·ª©c theo t√≠nh nƒÉng

```mermaid
graph LR
    A[Module Organization] --> B[‚úÖ Feature-based]
    A --> C[‚ùå Monolithic]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#ffebee
```

```mermaid
graph LR
    B[Feature-based] --> D[UserModule]
    B --> E[ProductModule]
    B --> F[OrderModule]
    
    C[Monolithic] --> G[BigModule]
    G --> H[UserController]
    G --> I[ProductController]
    G --> J[OrderController]
    
    style B fill:#e8f5e8
    style C fill:#ffebee
    style G fill:#ffebee
    style D fill:#f1f8e9
    style E fill:#fff3e0
    style F fill:#fce4ec
    style H fill:#f3e5f5
    style I fill:#e8f5e8
    style J fill:#fff3e0
```

```typescript title="Feature-based Module Organization"
// ‚úÖ T·ªët - M·ªói t√≠nh nƒÉng m·ªôt module
@Module({
  controllers: [UserController],
  providers: [UserService, UserRepository],
  exports: [UserService],
})
export class UserModule {}

// ‚ùå Kh√¥ng t·ªët - Module qu√° l·ªõn
@Module({
  controllers: [UserController, ProductController, OrderController],
  providers: [UserService, ProductService, OrderService, ...],
})
export class BigModule {}
```

### 2. Import c√≥ ch·ªçn l·ªçc
```typescript title="Selective Module Imports"
// ‚úÖ T·ªët - Ch·ªâ import c·∫ßn thi·∫øt
@Module({
  imports: [UserModule, AuthModule],
  controllers: [OrderController],
  providers: [OrderService],
})
export class OrderModule {}

// ‚ùå Kh√¥ng t·ªët - Import t·∫•t c·∫£
@Module({
  imports: [UserModule, ProductModule, AuthModule, PaymentModule, ...],
})
export class OrderModule {}
```

### 3. Export h·ª£p l√Ω
```typescript title="Selective Module Exports"
// ‚úÖ T·ªët - Ch·ªâ export c·∫ßn thi·∫øt
@Module({
  providers: [UserService, UserRepository, UserHelper],
  exports: [UserService], // Ch·ªâ export UserService
})
export class UserModule {}

// ‚ùå Kh√¥ng t·ªët - Export t·∫•t c·∫£
@Module({
  providers: [UserService, UserRepository, UserHelper],
  exports: [UserService, UserRepository, UserHelper], // Export t·∫•t c·∫£
})
export class UserModule {}
```

### 4. S·ª≠ d·ª•ng Shared Modules
```typescript title="Shared Module Usage"
// ‚úÖ T·ªët - T√°i s·ª≠ d·ª•ng logic chung
@Module({
  providers: [LoggerService, DatabaseService],
  exports: [LoggerService, DatabaseService],
})
export class SharedModule {}

// ‚ùå Kh√¥ng t·ªët - Duplicate code
@Module({
  providers: [LoggerService, DatabaseService], // Duplicate trong nhi·ªÅu modules
})
export class UserModule {}
```

### 5. Tr√°nh Circular Dependencies
```typescript title="Circular Dependencies Handling"
// ‚úÖ T·ªët - S·ª≠ d·ª•ng forwardRef khi c·∫ßn
@Module({
  imports: [forwardRef(() => OrderModule)],
})
export class UserModule {}

// ‚ùå Kh√¥ng t·ªët - Circular dependency tr·ª±c ti·∫øp
@Module({
  imports: [OrderModule], // S·∫Ω g√¢y l·ªói
})
export class UserModule {}
```

---

:::tip üí° L·ªùi khuy√™n t·ªïng k·∫øt
- B·∫Øt ƒë·∫ßu v·ªõi m·ªôt module ƒë∆°n gi·∫£n
- T√°ch module khi c√≥ nhi·ªÅu t√≠nh nƒÉng
- S·ª≠ d·ª•ng Global modules cho utilities chung
- Tr√°nh circular dependencies
- Test t·ª´ng module ƒë·ªôc l·∫≠p
- Export ch·ªâ nh·ªØng g√¨ c·∫ßn thi·∫øt
- S·ª≠ d·ª•ng Shared modules ƒë·ªÉ tr√°nh duplicate code
:::

**B√†i ti·∫øp theo:** [Controllers](/docs/overview/controllers)
