"use strict";(self.webpackChunktemplate_docs=self.webpackChunktemplate_docs||[]).push([[7865],{11470:(e,n,r)=>{r.d(n,{A:()=>I});var t=r(96540),a=r(34164),i=r(23104),s=r(56347),o=r(205),l=r(57485),c=r(31682),d=r(70679);function p(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:r}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:r,default:t}})=>({value:e,label:n,attributes:r,default:t}))}(r);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function h({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const r=(0,s.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(a),(0,t.useCallback)(e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})},[a,r])]}function g(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,i=u(e),[s,l]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i})),[c,p]=m({queryString:r,groupId:a}),[g,x]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,a]=(0,d.Dv)(n);return[r,(0,t.useCallback)(e=>{n&&a.set(e)},[n,a])]}({groupId:a}),v=(()=>{const e=c??g;return h({value:e,tabValues:i})?e:null})();(0,o.A)(()=>{v&&l(v)},[v]);return{selectedValue:s,selectValue:(0,t.useCallback)(e=>{if(!h({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),p(e),x(e)},[p,x,i]),tabValues:i}}var x=r(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(74848);function f({className:e,block:n,selectedValue:r,selectValue:t,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const n=e.currentTarget,a=o.indexOf(n),i=s[a].value;i!==r&&(l(n),t(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:t})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...t,className:(0,a.A)("tabs__item",v.tabItem,t?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function b({lazy:e,children:n,selectedValue:r}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===r);return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function V(e){const n=g(e);return(0,j.jsxs)("div",{className:(0,a.A)("tabs-container",v.tabList),children:[(0,j.jsx)(f,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function I(e){const n=(0,x.A)();return(0,j.jsx)(V,{...e,children:p(e.children)},String(n))}},19365:(e,n,r)=>{r.d(n,{A:()=>s});r(96540);var t=r(34164);const a={tabItem:"tabItem_Ymn6"};var i=r(74848);function s({children:e,hidden:n,className:r}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,r),hidden:n,children:e})}},28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>o});var t=r(96540);const a={},i=t.createContext(a);function s(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},56225:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"ecom-co/libs/grpc/docs/grpc-validation-pipe","title":"GrpcValidationPipe \u2014 gRPC Request Validation v\u1edbi class-validator","description":"Validation pipe cho gRPC requests s\u1eed d\u1ee5ng class-validator v\u1edbi custom error handling v\xe0 GrpcValidationException.","source":"@site/docs/ecom-co/libs/grpc/docs/grpc-validation-pipe.md","sourceDirName":"ecom-co/libs/grpc/docs","slug":"/grpc-validation-pipe","permalink":"/document/docs/grpc-validation-pipe","draft":false,"unlisted":false,"editUrl":"https://github.com/ecom-co/document/tree/main/docs/ecom-co/libs/grpc/docs/grpc-validation-pipe.md","tags":[{"inline":true,"label":"grpc","permalink":"/document/docs/tags/grpc"},{"inline":true,"label":"nestjs","permalink":"/document/docs/tags/nestjs"},{"inline":true,"label":"validation","permalink":"/document/docs/tags/validation"},{"inline":true,"label":"pipe","permalink":"/document/docs/tags/pipe"},{"inline":true,"label":"class-validator","permalink":"/document/docs/tags/class-validator"},{"inline":true,"label":"dto","permalink":"/document/docs/tags/dto"}],"version":"current","frontMatter":{"id":"grpc-validation-pipe","title":"GrpcValidationPipe \u2014 gRPC Request Validation v\u1edbi class-validator","sidebar_label":"GrpcValidationPipe","slug":"/grpc-validation-pipe","description":"Validation pipe cho gRPC requests s\u1eed d\u1ee5ng class-validator v\u1edbi custom error handling v\xe0 GrpcValidationException.","tags":["grpc","nestjs","validation","pipe","class-validator","dto"]},"sidebar":"tutorialSidebar","previous":{"title":"WrappedGrpc","permalink":"/document/docs/wrapped-grpc"},"next":{"title":"GrpcExceptionFilter (Server)","permalink":"/document/docs/grpc-server-exception-filter"}}');var a=r(74848),i=r(28453),s=r(11470),o=r(19365);const l={id:"grpc-validation-pipe",title:"GrpcValidationPipe \u2014 gRPC Request Validation v\u1edbi class-validator",sidebar_label:"GrpcValidationPipe",slug:"/grpc-validation-pipe",description:"Validation pipe cho gRPC requests s\u1eed d\u1ee5ng class-validator v\u1edbi custom error handling v\xe0 GrpcValidationException.",tags:["grpc","nestjs","validation","pipe","class-validator","dto"]},c=void 0,d={},p=[{value:"T\u1ed5ng quan",id:"t\u1ed5ng-quan",level:3},{value:"Features",id:"features",level:3},{value:"GrpcValidationPipeOptions",id:"grpcvalidationpipeoptions",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"Validation Error Response",id:"validation-error-response",level:3},{value:"Advanced DTO Examples",id:"advanced-dto-examples",level:3},{value:"Integration v\u1edbi Exception Filters",id:"integration-v\u1edbi-exception-filters",level:3},{value:"Testing",id:"testing",level:3},{value:"Best Practices",id:"best-practices",level:3}];function u(e){const n={admonition:"admonition",code:"code",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"GrpcValidationPipe"})," l\xe0 validation pipe chuy\xean d\u1ee5ng cho gRPC requests, s\u1eed d\u1ee5ng class-validator decorators v\u1edbi custom error serialization v\xe0 throw ",(0,a.jsx)(n.code,{children:"GrpcValidationException"})," \u0111\u1ec3 t\u01b0\u01a1ng th\xedch v\u1edbi gRPC error handling."]})}),"\n",(0,a.jsx)(n.h3,{id:"t\u1ed5ng-quan",children:"T\u1ed5ng quan"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"class-validator integration"}),": S\u1eed d\u1ee5ng decorators t\u1eeb class-validator (@IsString, @IsEmail, etc.)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Custom error handling"}),": Configurable error serialization v\xe0 exception factory"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"GrpcValidationException"}),": Throw structured gRPC validation errors"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Transform support"}),": class-transformer integration cho type conversion"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Validation groups"}),": Support cho conditional validation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Runtime configuration"}),": C\xf3 th\u1ec3 update options khi \u0111ang ch\u1ea1y"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"features",children:"Features"}),"\n",(0,a.jsx)(n.mermaid,{value:"flowchart TD\n    A[gRPC Request Data] --\x3e B[GrpcValidationPipe]\n    B --\x3e C[class-transformer]\n    C --\x3e D[plainToClass transformation]\n    D --\x3e E[class-validator]\n    E --\x3e F{Validation Pass?}\n    F -- Yes --\x3e G[Return transformed data]\n    F -- No --\x3e H[errorSerializer]\n    H --\x3e I[exceptionFactory]\n    I --\x3e J[throw GrpcValidationException]"}),"\n",(0,a.jsx)(n.h3,{id:"grpcvalidationpipeoptions",children:"GrpcValidationPipeOptions"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Option"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"M\u1eb7c \u0111\u1ecbnh"}),(0,a.jsx)(n.th,{children:"M\xf4 t\u1ea3"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"dataSerializer"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"function"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"identity"})}),(0,a.jsx)(n.td,{children:"Custom data serializer function"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"enableErrorLogging"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"boolean"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"false"})}),(0,a.jsx)(n.td,{children:"Log validation errors"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"errorMessagePrefix"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:'"Validation failed"'})}),(0,a.jsx)(n.td,{children:"Prefix cho error messages"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"errorSerializer"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"function"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"defaultErrorSerializer"})}),(0,a.jsx)(n.td,{children:"Custom error serializer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"exceptionFactory"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"function"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"defaultExceptionFactory"})}),(0,a.jsx)(n.td,{children:"Custom exception factory"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"stripUnknownProperties"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"boolean"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"true"})}),(0,a.jsx)(n.td,{children:"Remove unknown properties"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"transformOptions"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"object"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{}"})}),(0,a.jsx)(n.td,{children:"class-transformer options"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"validationGroups"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string[]"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"[]"})}),(0,a.jsx)(n.td,{children:"Validation groups"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"validationOptions"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"object"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{}"})}),(0,a.jsx)(n.td,{children:"class-validator options"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"basic",label:"Basic Validation",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// dto/create-user.dto.ts\nimport { IsEmail, IsString, MinLength, IsOptional, IsInt, Min, Max } from 'class-validator';\n\nexport class CreateUserDto {\n    @IsString()\n    @MinLength(2, { message: 'Name must be at least 2 characters' })\n    name: string;\n\n    @IsEmail({}, { message: 'Invalid email format' })\n    email: string;\n\n    @IsString()\n    @MinLength(8, { message: 'Password must be at least 8 characters' })\n    password: string;\n\n    @IsOptional()\n    @IsInt()\n    @Min(18, { message: 'Age must be at least 18' })\n    @Max(120, { message: 'Age must be less than 120' })\n    age?: number;\n}\n\n// user.controller.ts\nimport { Controller, UsePipes } from '@nestjs/common';\nimport { GrpcValidationPipe, GrpcMethod } from '@ecom-co/grpc';\n\n@Controller()\nexport class UserController {\n    @GrpcMethod('UserService', 'CreateUser')\n    @UsePipes(new GrpcValidationPipe())\n    async createUser(data: CreateUserDto) {\n        // data \u0111\xe3 \u0111\u01b0\u1ee3c validate v\xe0 transform\n        return this.userService.create(data);\n    }\n}\n"})})}),(0,a.jsx)(o.A,{value:"custom",label:"Custom Configuration",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// Custom validation pipe v\u1edbi error logging\nconst customValidationPipe = new GrpcValidationPipe({\n    enableErrorLogging: true,\n    errorMessagePrefix: 'Input validation failed',\n    stripUnknownProperties: true,\n    transformOptions: {\n        enableImplicitConversion: true,\n        excludeExtraneousValues: true,\n    },\n    validationOptions: {\n        whitelist: true, // Strip non-decorated properties\n        forbidNonWhitelisted: true, // Throw error for unknown properties\n    },\n});\n\n@Controller()\nexport class PaymentController {\n    @GrpcMethod('PaymentService', 'ProcessPayment')\n    @UsePipes(customValidationPipe)\n    async processPayment(data: PaymentDto) {\n        return this.paymentService.process(data);\n    }\n}\n"})})}),(0,a.jsx)(o.A,{value:"groups",label:"Validation Groups",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// dto v\u1edbi validation groups\nexport class UpdateUserDto {\n    @IsString()\n    @MinLength(2)\n    name: string;\n\n    @IsEmail()\n    @ValidateIf((o) => o.groups?.includes('email-update'))\n    email?: string;\n\n    @IsString()\n    @MinLength(8)\n    @ValidateIf((o) => o.groups?.includes('password-change'))\n    password?: string;\n\n    groups?: string[];\n}\n\n// S\u1eed d\u1ee5ng validation groups\n@GrpcMethod('UserService', 'UpdateProfile')\n@UsePipes(\n    new GrpcValidationPipe({\n        validationGroups: ['email-update'], // Ch\u1ec9 validate email\n    }),\n)\nasync updateProfile(data: UpdateUserDto) {\n    return this.userService.update(data);\n}\n\n@GrpcMethod('UserService', 'ChangePassword')\n@UsePipes(\n    new GrpcValidationPipe({\n        validationGroups: ['password-change'], // Ch\u1ec9 validate password\n    }),\n)\nasync changePassword(data: UpdateUserDto) {\n    return this.userService.changePassword(data);\n}\n"})})}),(0,a.jsx)(o.A,{value:"transform",label:"Transform Options",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// dto v\u1edbi transform decorators\nimport { Transform, Type } from 'class-transformer';\nimport { IsString, IsNumber, IsDate, ValidateNested } from 'class-validator';\n\nexport class AddressDto {\n    @IsString()\n    street: string;\n\n    @IsString()\n    city: string;\n\n    @IsString()\n    @Transform(({ value }) => value?.toUpperCase()) // Transform to uppercase\n    country: string;\n}\n\nexport class CreateUserDto {\n    @IsString()\n    @Transform(({ value }) => value?.trim()) // Trim whitespace\n    name: string;\n\n    @IsString()\n    @Transform(({ value }) => value?.toLowerCase()) // Transform to lowercase\n    email: string;\n\n    @IsNumber()\n    @Transform(({ value }) => parseInt(value)) // Convert string to number\n    age: number;\n\n    @IsDate()\n    @Type(() => Date) // Transform to Date object\n    birthDate: Date;\n\n    @ValidateNested()\n    @Type(() => AddressDto) // Nested object validation\n    address: AddressDto;\n}\n\n// Pipe v\u1edbi transform options\nconst transformValidationPipe = new GrpcValidationPipe({\n    transformOptions: {\n        enableImplicitConversion: true, // Auto convert types\n        excludeExtraneousValues: true, // Remove non-decorated properties\n        exposeDefaultValues: true, // Include default values\n    },\n    stripUnknownProperties: true,\n});\n"})})}),(0,a.jsx)(o.A,{value:"error",label:"Custom Error Handling",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// Custom error serializer\nconst customErrorSerializer = (errors: ValidationError[]): ValidationErrorInfo[] => {\n    return errors.map((error) => ({\n        property: error.property,\n        value: error.value,\n        constraints: error.constraints || {},\n        // Add custom fields\n        errorCode: `VALIDATION_${error.property.toUpperCase()}`,\n        severity: 'high',\n    }));\n};\n\n// Custom exception factory\nconst customExceptionFactory = (message: string, errors: ValidationErrorInfo[]) => {\n    const errorDetails = {\n        type: 'VALIDATION_ERROR',\n        errors: errors.map((e) => ({\n            field: e.property,\n            code: e.errorCode,\n            message: Object.values(e.constraints).join(', '),\n        })),\n        timestamp: new Date().toISOString(),\n    };\n\n    return new GrpcValidationException(JSON.stringify(errorDetails), errors);\n};\n\n// Pipe v\u1edbi custom handlers\nconst advancedValidationPipe = new GrpcValidationPipe({\n    errorSerializer: customErrorSerializer,\n    exceptionFactory: customExceptionFactory,\n    enableErrorLogging: true,\n});\n\n@Controller()\nexport class UserController {\n    @GrpcMethod('UserService', 'CreateUser')\n    @UsePipes(advancedValidationPipe)\n    async createUser(data: CreateUserDto) {\n        return this.userService.create(data);\n    }\n}\n"})})}),(0,a.jsx)(o.A,{value:"runtime",label:"Runtime Configuration",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// Runtime configuration methods\nconst pipe = new GrpcValidationPipe();\n\n// Chainable setters\npipe.setErrorLogging(true)\n    .setValidationGroups(['create', 'required'])\n    .setErrorSerializer((errors) => {\n        // Custom serialization logic\n        return errors.map((e) => ({ field: e.property, message: e.constraints }));\n    });\n\n// Update options object\npipe.updateOptions({\n    enableErrorLogging: process.env.NODE_ENV === 'development',\n    validationGroups: process.env.VALIDATION_GROUPS?.split(',') || [],\n});\n\n// Create new pipe with additional options\nconst newPipe = pipe.withOptions({\n    errorMessagePrefix: 'Custom validation error',\n    stripUnknownProperties: false,\n});\n"})})})]}),"\n",(0,a.jsx)(n.h3,{id:"validation-error-response",children:"Validation Error Response"}),"\n",(0,a.jsxs)(n.p,{children:["Khi validation fail, GrpcValidationPipe s\u1ebd throw ",(0,a.jsx)(n.code,{children:"GrpcValidationException"})," v\u1edbi format:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n    "code": 3,\n    "message": "Validation failed",\n    "details": {\n        "type": "VALIDATION_ERROR",\n        "errors": ["email must be an email", "password must be longer than or equal to 8 characters"],\n        "fieldErrors": {\n            "email": {\n                "isEmail": "email must be an email"\n            },\n            "password": {\n                "minLength": "password must be longer than or equal to 8 characters"\n            }\n        },\n        "timestamp": "2024-05-01T10:00:00.000Z"\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"advanced-dto-examples",children:"Advanced DTO Examples"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"nested",label:"Nested Validation",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// Nested DTOs v\u1edbi validation\nexport class ContactInfoDto {\n    @IsEmail()\n    email: string;\n\n    @IsString()\n    @Matches(/^\\+[1-9]\\d{1,14}$/, { message: 'Invalid phone number format' })\n    phone: string;\n}\n\nexport class PreferencesDto {\n    @IsBoolean()\n    emailNotifications: boolean;\n\n    @IsString()\n    @IsIn(['light', 'dark'], { message: 'Theme must be light or dark' })\n    theme: string;\n\n    @IsString()\n    @IsIn(['en', 'vi', 'ja'], { message: 'Invalid language' })\n    language: string;\n}\n\nexport class CreateUserDto {\n    @IsString()\n    @MinLength(2)\n    name: string;\n\n    @ValidateNested()\n    @Type(() => ContactInfoDto)\n    contact: ContactInfoDto;\n\n    @ValidateNested()\n    @Type(() => PreferencesDto)\n    @IsOptional()\n    preferences?: PreferencesDto;\n\n    @IsArray()\n    @IsString({ each: true })\n    @ArrayMinSize(1, { message: 'At least one role is required' })\n    roles: string[];\n}\n"})})}),(0,a.jsx)(o.A,{value:"conditional",label:"Conditional Validation",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"export class PaymentDto {\n    @IsNumber()\n    @Min(0.01, { message: 'Amount must be greater than 0' })\n    amount: number;\n\n    @IsString()\n    @IsIn(['credit_card', 'paypal', 'bank_transfer'])\n    method: string;\n\n    // Ch\u1ec9 required khi method l\xe0 credit_card\n    @ValidateIf((o) => o.method === 'credit_card')\n    @IsString()\n    @Matches(/^\\d{16}$/, { message: 'Invalid card number' })\n    cardNumber?: string;\n\n    @ValidateIf((o) => o.method === 'credit_card')\n    @IsString()\n    @Matches(/^\\d{3,4}$/, { message: 'Invalid CVV' })\n    cvv?: string;\n\n    // Required khi method l\xe0 paypal\n    @ValidateIf((o) => o.method === 'paypal')\n    @IsEmail()\n    paypalEmail?: string;\n\n    // Required khi method l\xe0 bank_transfer\n    @ValidateIf((o) => o.method === 'bank_transfer')\n    @IsString()\n    @MinLength(10, { message: 'Invalid account number' })\n    accountNumber?: string;\n}\n"})})}),(0,a.jsx)(o.A,{value:"custom-validators",label:"Custom Validators",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { registerDecorator, ValidationOptions, ValidationArguments } from 'class-validator';\n\n// Custom validator decorator\nexport function IsStrongPassword(validationOptions?: ValidationOptions) {\n    return function (object: object, propertyName: string) {\n        registerDecorator({\n            name: 'isStrongPassword',\n            target: object.constructor,\n            propertyName: propertyName,\n            options: validationOptions,\n            validator: {\n                validate(value: any, args: ValidationArguments) {\n                    if (typeof value !== 'string') return false;\n\n                    // At least 8 chars, 1 uppercase, 1 lowercase, 1 number, 1 special char\n                    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\n                    return strongPasswordRegex.test(value);\n                },\n                defaultMessage(args: ValidationArguments) {\n                    return 'Password must contain at least 8 characters, 1 uppercase, 1 lowercase, 1 number and 1 special character';\n                },\n            },\n        });\n    };\n}\n\n// Usage trong DTO\nexport class CreateUserDto {\n    @IsString()\n    name: string;\n\n    @IsEmail()\n    email: string;\n\n    @IsStrongPassword()\n    password: string;\n}\n"})})})]}),"\n",(0,a.jsx)(n.h3,{id:"integration-v\u1edbi-exception-filters",children:"Integration v\u1edbi Exception Filters"}),"\n",(0,a.jsx)(n.p,{children:"GrpcValidationPipe ho\u1ea1t \u0111\u1ed9ng seamlessly v\u1edbi exception filters:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// GrpcExceptionFilter s\u1ebd t\u1ef1 \u0111\u1ed9ng handle GrpcValidationException\n@Controller()\n@UseFilters(GrpcExceptionFilter) // Server-side filter\nexport class UserController {\n    @GrpcMethod('UserService', 'CreateUser')\n    @UsePipes(new GrpcValidationPipe())\n    async createUser(data: CreateUserDto) {\n        // N\u1ebfu validation fail \u2192 GrpcValidationException \u2192 GrpcExceptionFilter \u2192 RpcException\n        return this.userService.create(data);\n    }\n}\n\n// Ho\u1eb7c v\u1edbi GrpcClientFilter \u1edf HTTP layer\n@Controller('users')\n@UseFilters(GrpcClientFilter) // Client-side filter\nexport class HttpUserController {\n    @Post()\n    async createUser(@Body() userData: CreateUserDto) {\n        // gRPC call c\xf3 th\u1ec3 throw GrpcValidationException \u2192 GrpcClientFilter \u2192 HTTP response\n        return this.userGrpcService.create(userData);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"unit",label:"Unit Testing",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// user.controller.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { GrpcValidationPipe, GrpcValidationException } from '@ecom-co/grpc';\nimport { UserController } from './user.controller';\nimport { CreateUserDto } from './dto/create-user.dto';\n\ndescribe('UserController with GrpcValidationPipe', () => {\n    let controller: UserController;\n    let pipe: GrpcValidationPipe;\n\n    beforeEach(async () => {\n        const module: TestingModule = await Test.createTestingModule({\n            controllers: [UserController],\n            providers: [\n                {\n                    provide: 'UserService',\n                    useValue: {\n                        create: jest.fn(),\n                    },\n                },\n            ],\n        }).compile();\n\n        controller = module.get<UserController>(UserController);\n        pipe = new GrpcValidationPipe({\n            enableErrorLogging: false, // T\u1eaft log trong test\n        });\n    });\n\n    it('should validate valid input', async () => {\n        const validInput = {\n            name: 'John Doe',\n            email: 'john@example.com',\n            password: 'StrongPass123!',\n            age: 25,\n        };\n\n        const result = await pipe.transform(validInput, {\n            type: 'body',\n            metatype: CreateUserDto,\n        });\n\n        expect(result).toEqual(expect.objectContaining(validInput));\n    });\n\n    it('should throw GrpcValidationException for invalid input', async () => {\n        const invalidInput = {\n            name: '', // Too short\n            email: 'invalid-email', // Invalid format\n            password: '123', // Too short\n            age: 15, // Below minimum\n        };\n\n        await expect(\n            pipe.transform(invalidInput, {\n                type: 'body',\n                metatype: CreateUserDto,\n            }),\n        ).rejects.toThrow(GrpcValidationException);\n    });\n});\n"})})}),(0,a.jsx)(o.A,{value:"e2e",label:"E2E Testing",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// user.e2e-spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { GrpcValidationPipe } from '@ecom-co/grpc';\nimport { AppModule } from '../src/app.module';\n\ndescribe('User gRPC Service (e2e)', () => {\n    let app: INestApplication;\n\n    beforeEach(async () => {\n        const moduleFixture: TestingModule = await Test.createTestingModule({\n            imports: [AppModule],\n        }).compile();\n\n        app = moduleFixture.createNestApplication();\n        app.useGlobalPipes(new GrpcValidationPipe());\n        await app.init();\n    });\n\n    it('should reject invalid user data', async () => {\n        const invalidUserData = {\n            name: '',\n            email: 'invalid',\n            password: '123',\n        };\n\n        // Test gRPC call v\u1edbi invalid data\n        const result = await grpcClient.createUser(invalidUserData);\n\n        expect(result.error).toBeDefined();\n        expect(result.error.code).toBe(3); // INVALID_ARGUMENT\n        expect(result.error.details).toContain('VALIDATION_ERROR');\n    });\n});\n"})})})]}),"\n",(0,a.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"S\u1eed d\u1ee5ng DTOs"})," v\u1edbi class-validator decorators cho t\u1ea5t c\u1ea3 gRPC inputs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enable error logging"})," trong development \u0111\u1ec3 debug validation issues"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Custom error serializers"})," cho domain-specific error formats"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Validation groups"})," cho conditional validation scenarios"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Transform options"})," \u0111\u1ec3 auto-convert v\xe0 sanitize input data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Combine v\u1edbi exception filters"})," \u0111\u1ec3 handle validation errors properly"]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"GrpcValidationPipe \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 work seamlessly v\u1edbi GrpcExceptionFilter v\xe0 GrpcClientFilter, t\u1ea1o th\xe0nh complete validation pipeline t\u1eeb gRPC \u2192 HTTP."})}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["Validation ch\u1ec9 \xe1p d\u1ee5ng cho parameters c\xf3 ",(0,a.jsx)(n.code,{children:"metatype"})," (class). Primitive types (string, number, boolean) s\u1ebd \u0111\u01b0\u1ee3c pass through m\xe0 kh\xf4ng validate."]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);