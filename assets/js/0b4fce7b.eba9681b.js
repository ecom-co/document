"use strict";(self.webpackChunktemplate_docs=self.webpackChunktemplate_docs||[]).push([[5148],{199:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"overview/request-lifecycle","title":"Request Lifecycle","description":"T\xecm hi\u1ec3u v\u1ec1 Request Lifecycle - c\xe1ch NestJS x\u1eed l\xfd m\u1ed9t HTTP request t\u1eeb \u0111\u1ea7u \u0111\u1ebfn cu\u1ed1i","source":"@site/docs/overview/request-lifecycle.md","sourceDirName":"overview","slug":"/overview/request-lifecycle","permalink":"/document/docs/overview/request-lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/ecom-co/document/tree/main/docs/overview/request-lifecycle.md","tags":[],"version":"current","frontMatter":{"title":"Request Lifecycle","description":"T\xecm hi\u1ec3u v\u1ec1 Request Lifecycle - c\xe1ch NestJS x\u1eed l\xfd m\u1ed9t HTTP request t\u1eeb \u0111\u1ea7u \u0111\u1ebfn cu\u1ed1i"},"sidebar":"tutorialSidebar","previous":{"title":"Providers","permalink":"/document/docs/overview/providers"},"next":{"title":"Middleware","permalink":"/document/docs/overview/middleware"}}');var s=i(4848),t=i(8453);const l={title:"Request Lifecycle",description:"T\xecm hi\u1ec3u v\u1ec1 Request Lifecycle - c\xe1ch NestJS x\u1eed l\xfd m\u1ed9t HTTP request t\u1eeb \u0111\u1ea7u \u0111\u1ebfn cu\u1ed1i"},c="Request Lifecycle",o={},d=[{value:"Request Lifecycle l\xe0 g\xec?",id:"request-lifecycle-l\xe0-g\xec",level:2},{value:"C\xe1c b\u01b0\u1edbc trong Request Lifecycle",id:"c\xe1c-b\u01b0\u1edbc-trong-request-lifecycle",level:2},{value:"1. Middleware",id:"1-middleware",level:3},{value:"2. Guards",id:"2-guards",level:3},{value:"3. Interceptors",id:"3-interceptors",level:3},{value:"4. Pipes",id:"4-pipes",level:3},{value:"5. Controller",id:"5-controller",level:3},{value:"6. Service",id:"6-service",level:3},{value:"S\u01a1 \u0111\u1ed3 chi ti\u1ebft Request Lifecycle",id:"s\u01a1-\u0111\u1ed3-chi-ti\u1ebft-request-lifecycle",level:2},{value:"Exception Handling",id:"exception-handling",level:2},{value:"Lifecycle Hooks",id:"lifecycle-hooks",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Middleware Order",id:"1-middleware-order",level:3},{value:"2. Guard Placement",id:"2-guard-placement",level:3},{value:"3. Interceptor Usage",id:"3-interceptor-usage",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"request-lifecycle",children:"Request Lifecycle"})}),"\n",(0,s.jsx)(n.p,{children:"Request Lifecycle trong NestJS l\xe0 qu\xe1 tr\xecnh x\u1eed l\xfd m\u1ed9t HTTP request t\u1eeb khi nh\u1eadn request \u0111\u1ebfn khi tr\u1ea3 v\u1ec1 response. Hi\u1ec3u \u0111\u01b0\u1ee3c lifecycle n\xe0y gi\xfap b\u1ea1n bi\u1ebft c\xe1ch NestJS ho\u1ea1t \u0111\u1ed9ng v\xe0 c\xe1ch t\xf9y ch\u1ec9nh behavior."}),"\n",(0,s.jsx)(n.mermaid,{value:'flowchart LR\n    A[HTTP Request] --\x3e B[Middleware]\n    B --\x3e C[Guards]\n    C --\x3e D[Interceptors Before]\n    D --\x3e E[Pipes]\n    E --\x3e F[Controller]\n    F --\x3e G[Interceptors After]\n    G --\x3e H[HTTP Response]\n    \n    subgraph Pipeline["NestJS Application Pipeline"]\n        B\n        C\n        D\n        E\n        F\n        G\n    end\n    \n    I[Exception Filters] -.->|"Error handling at any stage"| Pipeline\n    \n    style A fill:#e3f2fd\n    style B fill:#f3e5f5\n    style C fill:#e8f5e8\n    style D fill:#fff3e0\n    style E fill:#fce4ec\n    style F fill:#f1f8e9\n    style G fill:#e1f5fe\n    style H fill:#e8f5e8\n    style I fill:#fff3e0\n    style Pipeline fill:#f9f9f9,stroke:#666,stroke-width:2px,stroke-dasharray: 5 5'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Th\u1ee9 t\u1ef1 x\u1eed l\xfd:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Middleware"})," - X\u1eed l\xfd request tr\u01b0\u1edbc"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Guards"})," - Ki\u1ec3m tra quy\u1ec1n truy c\u1eadp"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interceptors"})," - X\u1eed l\xfd tr\u01b0\u1edbc controller"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pipes"})," - Validate v\xe0 transform data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Controller"})," - X\u1eed l\xfd route v\xe0 g\u1ecdi service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service"})," - Th\u1ef1c hi\u1ec7n business logic"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"})," - Tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"\ud83d\udca1 Kh\xe1i ni\u1ec7m c\u01a1 b\u1ea3n",type:"tip",children:(0,s.jsx)(n.p,{children:'Request Lifecycle gi\u1ed1ng nh\u01b0 m\u1ed9t "d\xe2y chuy\u1ec1n s\u1ea3n xu\u1ea5t" x\u1eed l\xfd request. M\u1ed7i b\u01b0\u1edbc c\xf3 nhi\u1ec7m v\u1ee5 ri\xeang v\xe0 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\xf9y ch\u1ec9nh.'})}),"\n",(0,s.jsx)(n.h2,{id:"request-lifecycle-l\xe0-g\xec",children:"Request Lifecycle l\xe0 g\xec?"}),"\n",(0,s.jsx)(n.p,{children:"Request Lifecycle trong NestJS:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sequential Processing"})," - X\u1eed l\xfd tu\u1ea7n t\u1ef1 qua c\xe1c b\u01b0\u1edbc"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Middleware Chain"})," - Chu\u1ed7i middleware x\u1eed l\xfd request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security & Validation"})," - Ki\u1ec3m tra b\u1ea3o m\u1eadt v\xe0 validate data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Business Logic"})," - X\u1eed l\xfd logic nghi\u1ec7p v\u1ee5"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response Generation"})," - T\u1ea1o v\xe0 tr\u1ea3 v\u1ec1 response"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"c\xe1c-b\u01b0\u1edbc-trong-request-lifecycle",children:"C\xe1c b\u01b0\u1edbc trong Request Lifecycle"}),"\n",(0,s.jsx)(n.h3,{id:"1-middleware",children:"1. Middleware"}),"\n",(0,s.jsx)(n.p,{children:"X\u1eed l\xfd request tr\u01b0\u1edbc khi \u0111\u1ebfn controller (CORS, logging, compression)"}),"\n",(0,s.jsx)(n.h3,{id:"2-guards",children:"2. Guards"}),"\n",(0,s.jsx)(n.p,{children:"Ki\u1ec3m tra quy\u1ec1n truy c\u1eadp (authentication, authorization)"}),"\n",(0,s.jsx)(n.h3,{id:"3-interceptors",children:"3. Interceptors"}),"\n",(0,s.jsx)(n.p,{children:"X\u1eed l\xfd request/response tr\u01b0\u1edbc v\xe0 sau controller (transformation, logging)"}),"\n",(0,s.jsx)(n.h3,{id:"4-pipes",children:"4. Pipes"}),"\n",(0,s.jsx)(n.p,{children:"Validate v\xe0 transform data tr\u01b0\u1edbc khi \u0111\u1ebfn controller"}),"\n",(0,s.jsx)(n.h3,{id:"5-controller",children:"5. Controller"}),"\n",(0,s.jsx)(n.p,{children:"X\u1eed l\xfd route v\xe0 g\u1ecdi service \u0111\u1ec3 th\u1ef1c hi\u1ec7n business logic"}),"\n",(0,s.jsx)(n.h3,{id:"6-service",children:"6. Service"}),"\n",(0,s.jsx)(n.p,{children:"Th\u1ef1c hi\u1ec7n business logic v\xe0 x\u1eed l\xfd data"}),"\n",(0,s.jsx)(n.h2,{id:"s\u01a1-\u0111\u1ed3-chi-ti\u1ebft-request-lifecycle",children:"S\u01a1 \u0111\u1ed3 chi ti\u1ebft Request Lifecycle"}),"\n",(0,s.jsx)(n.mermaid,{value:'flowchart TD\n    A[HTTP Request] --\x3e B[Middleware]\n    B --\x3e C[Guards]\n    C --\x3e D[Interceptors Before]\n    D --\x3e E[Pipes]\n    E --\x3e F[Controller]\n    F --\x3e G[Interceptors After]\n    G --\x3e H[HTTP Response]\n    \n    subgraph Pipeline["NestJS Pipeline"]\n        B\n        C\n        D\n        E\n        F\n        G\n    end\n    \n    I[Exception Filters] -.->|"Error handling at any stage"| Pipeline\n    \n    style A fill:#e3f2fd\n    style B fill:#f3e5f5\n    style C fill:#e8f5e8\n    style D fill:#fff3e0\n    style E fill:#fce4ec\n    style F fill:#f1f8e9\n    style G fill:#e1f5fe\n    style H fill:#e8f5e8\n    style I fill:#fff3e0\n    style Pipeline fill:#f9f9f9,stroke:#666,stroke-width:2px,stroke-dasharray: 5 5'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Gi\u1ea3i th\xedch chi ti\u1ebft:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Middleware"}),": X\u1eed l\xfd request (CORS, logging, compression)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Guards"}),": Ki\u1ec3m tra authentication/authorization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interceptors Before"}),": X\u1eed l\xfd tr\u01b0\u1edbc khi \u0111\u1ebfn controller"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pipes"}),": Validate v\xe0 transform data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Controller"}),": X\u1eed l\xfd route v\xe0 g\u1ecdi service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service"}),": Th\u1ef1c hi\u1ec7n business logic"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interceptors After"}),": X\u1eed l\xfd response tr\u01b0\u1edbc khi tr\u1ea3 v\u1ec1"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Exception Filters"}),": X\u1eed l\xfd l\u1ed7i n\u1ebfu c\xf3"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"}),": Tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3 cu\u1ed1i c\xf9ng"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u0110\u1ecbnh ngh\u0129a:"})," Exception Filters x\u1eed l\xfd l\u1ed7i trong qu\xe1 tr\xecnh x\u1eed l\xfd request."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Vai tr\xf2:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Catch v\xe0 x\u1eed l\xfd exceptions"}),"\n",(0,s.jsx)(n.li,{children:"Format error responses"}),"\n",(0,s.jsx)(n.li,{children:"Logging errors"}),"\n",(0,s.jsx)(n.li,{children:"User-friendly error messages"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="Exception Filter Example"',children:"@Catch(HttpException)\nexport class HttpExceptionFilter implements ExceptionFilter {\n  catch(exception: HttpException, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse();\n    const status = exception.getStatus();\n\n    response.status(status).json({\n      statusCode: status,\n      message: exception.message,\n      timestamp: new Date().toISOString(),\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"lifecycle-hooks",children:"Lifecycle Hooks"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u0110\u1ecbnh ngh\u0129a:"})," Lifecycle hooks cho ph\xe9p can thi\u1ec7p v\xe0o c\xe1c giai \u0111o\u1ea1n kh\xe1c nhau c\u1ee7a request."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"C\xe1c hooks ch\xednh:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OnModuleInit"})," - Sau khi module kh\u1edfi t\u1ea1o"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OnModuleDestroy"})," - Tr\u01b0\u1edbc khi module h\u1ee7y"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OnApplicationBootstrap"})," - Sau khi app bootstrap"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OnApplicationShutdown"})," - Tr\u01b0\u1edbc khi app shutdown"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="Lifecycle Hooks Example"',children:"@Injectable()\nexport class AppService implements OnModuleInit, OnModuleDestroy {\n  onModuleInit() {\n    console.log('Module initialized');\n  }\n\n  onModuleDestroy() {\n    console.log('Module destroyed');\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-middleware-order",children:"1. Middleware Order"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="Middleware Order Best Practice"',children:"// \u2705 T\u1ed1t - Th\u1ee9 t\u1ef1 logic\napp.use(helmet());           // Security first\napp.use(cors());            // CORS handling\napp.use(compression());     // Compression\napp.use(express.json());    // Body parsing\napp.use(logger);           // Logging last\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-guard-placement",children:"2. Guard Placement"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="Guard Placement Best Practice"',children:"// \u2705 T\u1ed1t - Guard \u1edf controller level\n@UseGuards(AuthGuard)\n@Controller('users')\nexport class UserController {\n  // T\u1ea5t c\u1ea3 routes \u0111\u1ec1u \u0111\u01b0\u1ee3c b\u1ea3o v\u1ec7\n}\n\n// \u2705 T\u1ed1t - Guard \u1edf method level\n@Get('admin')\n@UseGuards(AdminGuard)\nadminOnly() {\n  // Ch\u1ec9 admin m\u1edbi access \u0111\u01b0\u1ee3c\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-interceptor-usage",children:"3. Interceptor Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="Interceptor Usage Best Practice"',children:"// \u2705 T\u1ed1t - Global interceptor\napp.useGlobalInterceptors(new LoggingInterceptor());\n\n// \u2705 T\u1ed1t - Controller interceptor\n@UseInterceptors(TransformInterceptor)\n@Controller('users')\nexport class UserController {}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.admonition,{title:"\ud83d\udca1 L\u1eddi khuy\xean t\u1ed5ng k\u1ebft",type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hi\u1ec3u r\xf5 th\u1ee9 t\u1ef1 c\xe1c b\u01b0\u1edbc trong Request Lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"S\u1eed d\u1ee5ng \u0111\xfang component cho \u0111\xfang m\u1ee5c \u0111\xedch"}),"\n",(0,s.jsx)(n.li,{children:"Middleware cho request processing"}),"\n",(0,s.jsx)(n.li,{children:"Guards cho authentication/authorization"}),"\n",(0,s.jsx)(n.li,{children:"Interceptors cho transformation"}),"\n",(0,s.jsx)(n.li,{children:"Pipes cho validation"}),"\n",(0,s.jsx)(n.li,{children:"Exception filters cho error handling"}),"\n"]})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"B\xe0i ti\u1ebfp theo:"})," ",(0,s.jsx)(n.a,{href:"/docs/overview/middleware",children:"Middleware"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);