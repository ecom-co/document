"use strict";(self.webpackChunktemplate_docs=self.webpackChunktemplate_docs||[]).push([[5389],{11470:(e,n,r)=>{r.d(n,{A:()=>y});var t=r(96540),i=r(34164),s=r(23104),o=r(56347),a=r(205),l=r(57485),c=r(31682),d=r(70679);function u(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:r,default:t}})=>({value:e,label:n,attributes:r,default:t}))}(r);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function h({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const r=(0,o.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(i),(0,t.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(r.location.search);n.set(i,e),r.replace({...r.location,search:n.toString()})},[i,r])]}function g(e){const{defaultValue:n,queryString:r=!1,groupId:i}=e,s=p(e),[o,l]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s})),[c,u]=m({queryString:r,groupId:i}),[g,x]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,i]=(0,d.Dv)(n);return[r,(0,t.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),j=(()=>{const e=c??g;return h({value:e,tabValues:s})?e:null})();(0,a.A)(()=>{j&&l(j)},[j]);return{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),x(e)},[u,x,s]),tabValues:s}}var x=r(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=r(74848);function f({className:e,block:n,selectedValue:r,selectValue:t,tabValues:o}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const n=e.currentTarget,i=a.indexOf(n),s=o[i].value;s!==r&&(l(n),t(s))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=a.indexOf(e.currentTarget)+1;n=a[r]??a[0];break}case"ArrowLeft":{const r=a.indexOf(e.currentTarget)-1;n=a[r]??a[a.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:o.map(({value:e,label:n,attributes:t})=>(0,v.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...t,className:(0,i.A)("tabs__item",j.tabItem,t?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function b({lazy:e,children:n,selectedValue:r}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===r);return e?(0,t.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function E(e){const n=g(e);return(0,v.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,v.jsx)(f,{...n,...e}),(0,v.jsx)(b,{...n,...e})]})}function y(e){const n=(0,x.A)();return(0,v.jsx)(E,{...e,children:u(e.children)},String(n))}},19365:(e,n,r)=>{r.d(n,{A:()=>o});r(96540);var t=r(34164);const i={tabItem:"tabItem_Ymn6"};var s=r(74848);function o({children:e,hidden:n,className:r}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(i.tabItem,r),hidden:n,children:e})}},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(96540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},79824:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"ecom-co/libs/utils/docs/http-exception-filter","title":"HttpExceptionFilter \u2014 Global Exception Handler","description":"Global exception filter cho NestJS applications, cung c\u1ea5p comprehensive error handling v\u1edbi sanitization, metrics tracking, rate limiting v\xe0 security features.","source":"@site/docs/ecom-co/libs/utils/docs/http-exception-filter.md","sourceDirName":"ecom-co/libs/utils/docs","slug":"/http-exception-filter","permalink":"/document/docs/http-exception-filter","draft":false,"unlisted":false,"editUrl":"https://github.com/ecom-co/document/tree/main/docs/ecom-co/libs/utils/docs/http-exception-filter.md","tags":[{"inline":true,"label":"exception-filter","permalink":"/document/docs/tags/exception-filter"},{"inline":true,"label":"error-handling","permalink":"/document/docs/tags/error-handling"},{"inline":true,"label":"security","permalink":"/document/docs/tags/security"},{"inline":true,"label":"sanitization","permalink":"/document/docs/tags/sanitization"},{"inline":true,"label":"metrics","permalink":"/document/docs/tags/metrics"},{"inline":true,"label":"rate-limiting","permalink":"/document/docs/tags/rate-limiting"},{"inline":true,"label":"nestjs","permalink":"/document/docs/tags/nestjs"},{"inline":true,"label":"typescript","permalink":"/document/docs/tags/typescript"}],"version":"current","frontMatter":{"id":"http-exception-filter","title":"HttpExceptionFilter \u2014 Global Exception Handler","sidebar_label":"HttpExceptionFilter","slug":"/http-exception-filter","description":"Global exception filter cho NestJS applications, cung c\u1ea5p comprehensive error handling v\u1edbi sanitization, metrics tracking, rate limiting v\xe0 security features.","tags":["exception-filter","error-handling","security","sanitization","metrics","rate-limiting","nestjs","typescript"]},"sidebar":"tutorialSidebar","previous":{"title":"Validate Decorator","permalink":"/document/docs/validate-decorator"},"next":{"title":"DTO Module","permalink":"/document/docs/dto-module"}}');var i=r(74848),s=r(28453),o=r(11470),a=r(19365);const l={id:"http-exception-filter",title:"HttpExceptionFilter \u2014 Global Exception Handler",sidebar_label:"HttpExceptionFilter",slug:"/http-exception-filter",description:"Global exception filter cho NestJS applications, cung c\u1ea5p comprehensive error handling v\u1edbi sanitization, metrics tracking, rate limiting v\xe0 security features.",tags:["exception-filter","error-handling","security","sanitization","metrics","rate-limiting","nestjs","typescript"]},c=void 0,d={},u=[{value:"T\u1ed5ng quan",id:"t\u1ed5ng-quan",level:3},{value:"C\xe1ch ho\u1ea1t \u0111\u1ed9ng",id:"c\xe1ch-ho\u1ea1t-\u0111\u1ed9ng",level:3},{value:"Ki\u1ebfn tr\xfac Module",id:"ki\u1ebfn-tr\xfac-module",level:3},{value:"1. Configuration Options",id:"1-configuration-options",level:2},{value:"HttpExceptionFilterOptions",id:"httpexceptionfilteroptions",level:3},{value:"Constructor Parameters",id:"constructor-parameters",level:3},{value:"2. Core Features",id:"2-core-features",level:2},{value:"2.1 Exception Type Handling",id:"21-exception-type-handling",level:3},{value:"ValidationException",id:"validationexception",level:4},{value:"HttpException",id:"httpexception",level:4},{value:"Custom Error Types",id:"custom-error-types",level:4},{value:"2.2 Data Sanitization",id:"22-data-sanitization",level:3},{value:"Sensitive Patterns",id:"sensitive-patterns",level:4},{value:"Sanitization Process",id:"sanitization-process",level:4},{value:"2.3 Security Headers",id:"23-security-headers",level:3},{value:"2.4 Correlation ID Management",id:"24-correlation-id-management",level:3},{value:"3. Usage Examples",id:"3-usage-examples",level:2},{value:"3.1 Basic Setup",id:"31-basic-setup",level:3},{value:"3.2 Custom Error Messages",id:"32-custom-error-messages",level:3},{value:"3.3 Integration v\u1edbi Error Metrics",id:"33-integration-v\u1edbi-error-metrics",level:3},{value:"4. Error Response Format",id:"4-error-response-format",level:2},{value:"Standard Error Response",id:"standard-error-response",level:3},{value:"Development Mode Response",id:"development-mode-response",level:3},{value:"5. Advanced Features",id:"5-advanced-features",level:2},{value:"5.1 Rate Limit Tracking",id:"51-rate-limit-tracking",level:3},{value:"5.2 Error Logging",id:"52-error-logging",level:3},{value:"5.3 Timeout Protection",id:"53-timeout-protection",level:3},{value:"6. Best Practices",id:"6-best-practices",level:2},{value:"6.1 Security Considerations",id:"61-security-considerations",level:3},{value:"6.2 Performance Optimization",id:"62-performance-optimization",level:3},{value:"6.3 Development vs Production",id:"63-development-vs-production",level:3},{value:"7. Troubleshooting",id:"7-troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"8. Integration Examples",id:"8-integration-examples",level:2},{value:"8.1 v\u1edbi Validation Pipe",id:"81-v\u1edbi-validation-pipe",level:3},{value:"8.2 v\u1edbi Logger Service",id:"82-v\u1edbi-logger-service",level:3},{value:"8.3 v\u1edbi Monitoring Systems",id:"83-v\u1edbi-monitoring-systems",level:3}];function p(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"HttpExceptionFilter l\xe0 global exception filter \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 x\u1eed l\xfd t\u1ea5t c\u1ea3 exceptions trong NestJS application, cung c\u1ea5p error handling chu\u1ea9n h\xf3a v\u1edbi c\xe1c t\xednh n\u0103ng b\u1ea3o m\u1eadt v\xe0 monitoring n\xe2ng cao."})}),"\n",(0,i.jsx)(n.h3,{id:"t\u1ed5ng-quan",children:"T\u1ed5ng quan"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"M\u1ee5c ti\xeau"}),": Chu\u1ea9n h\xf3a error handling v\xe0 cung c\u1ea5p security features cho to\xe0n b\u1ed9 application"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u0110i\u1ec3m n\u1ed5i b\u1eadt"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Comprehensive Error Handling"}),": X\u1eed l\xfd t\u1ea5t c\u1ea3 lo\u1ea1i exceptions (HTTP, Validation, Custom)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Security Features"}),": Sanitization, security headers, sensitive data protection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitoring & Metrics"}),": Error tracking, rate limit monitoring, correlation IDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Development Support"}),": Detailed error information trong development mode"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Production Safety"}),": Sanitized error messages \u0111\u1ec3 tr\xe1nh information leakage"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": Timeout protection v\xe0 fallback error handling"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"c\xe1ch-ho\u1ea1t-\u0111\u1ed9ng",children:"C\xe1ch ho\u1ea1t \u0111\u1ed9ng"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TD\n    A[Exception Occurs] --\x3e B[HttpExceptionFilter catch]\n    B --\x3e C{Response Headers Sent?}\n    C --\x3e|Yes| D[Log Warning Return]\n    C --\x3e|No| E[Get HTTP Status]\n    E --\x3e F[Build Error Response]\n    F --\x3e G{Exception Type?}\n\n    G --\x3e|ValidationException| H[Handle Validation Errors]\n    G --\x3e|HttpException| I[Handle HTTP Errors]\n    G --\x3e|Other| J[Handle Generic Errors]\n\n    H --\x3e K[Sanitize if Production]\n    I --\x3e K\n    J --\x3e K\n\n    K --\x3e L[Add Security Headers]\n    L --\x3e M[Log Error with Context]\n    M --\x3e N[Send Error Response]\n    N --\x3e O[Set Timeout Protection]\n\n    subgraph "Error Processing"\n        P[Sanitization]\n        Q[Metrics Tracking]\n        R[Rate Limit Tracking]\n        S[Correlation ID]\n    end\n\n    F --\x3e P\n    F --\x3e Q\n    F --\x3e R\n    F --\x3e S'}),"\n",(0,i.jsx)(n.h3,{id:"ki\u1ebfn-tr\xfac-module",children:"Ki\u1ebfn tr\xfac Module"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph LR\n    subgraph "Core Components"\n        A[Exception Handler]\n        B[Error Builder]\n        C[Response Formatter]\n    end\n\n    subgraph "Security Features"\n        D[Data Sanitization]\n        E[Security Headers]\n        F[Sensitive Pattern Detection]\n    end\n\n    subgraph "Monitoring"\n        G[Error Metrics]\n        H[Rate Limit Tracking]\n        I[Logging System]\n    end\n\n    subgraph "Configuration"\n        J[Filter Options]\n        K[Development Mode]\n        L[Custom Messages]\n    end\n\n    A --\x3e B\n    B --\x3e C\n    A --\x3e D\n    A --\x3e E\n    A --\x3e F\n    A --\x3e G\n    A --\x3e H\n    A --\x3e I\n    J --\x3e A\n    K --\x3e A\n    L --\x3e A'}),"\n",(0,i.jsx)(n.h2,{id:"1-configuration-options",children:"1. Configuration Options"}),"\n",(0,i.jsx)(n.h3,{id:"httpexceptionfilteroptions",children:"HttpExceptionFilterOptions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"M\xf4 t\u1ea3"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isDevelopment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"B\u1eadt development mode cho detailed errors"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enableSanitization"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"B\u1eadt data sanitization"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enableMetrics"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"B\u1eadt error metrics tracking"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enableRateLimitTracking"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"B\u1eadt rate limit monitoring"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"customErrorMessages"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Record<number, string>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{}"})}),(0,i.jsx)(n.td,{children:"Custom error messages theo status code"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"constructor-parameters",children:"Constructor Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"M\xf4 t\u1ea3"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"reflector"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Reflector"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"NestJS reflector cho metadata access"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"options"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HttpExceptionFilterOptions"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Configuration options"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"errorMetrics"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorMetrics"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Error metrics tracker"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rateLimitTracker"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RateLimitTracker"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Rate limit tracker"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"2-core-features",children:"2. Core Features"}),"\n",(0,i.jsx)(n.h3,{id:"21-exception-type-handling",children:"2.1 Exception Type Handling"}),"\n",(0,i.jsx)(n.h4,{id:"validationexception",children:"ValidationException"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// T\u1ef1 \u0111\u1ed9ng x\u1eed l\xfd validation errors\nif (exception instanceof ValidationException) {\n    const validationMessages = exception.getValidationMessages();\n    const fieldErrors = exception.getFieldErrors();\n\n    // Format validation errors theo ErrorResponseDto\n    return {\n        error: 'Validation failed',\n        errors: validationMessages,\n        fieldErrors,\n        message: 'Validation failed',\n        // ... other properties\n    };\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"httpexception",children:"HttpException"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// X\u1eed l\xfd NestJS HTTP exceptions\nif (exception instanceof HttpException) {\n    const status = exception.getStatus();\n    const response = exception.getResponse();\n\n    // Format theo exception response\n    return {\n        error: response.error || 'HTTP Error',\n        message: response.message || exception.message,\n        statusCode: status,\n    };\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"custom-error-types",children:"Custom Error Types"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Mapping custom error names v\u1edbi HTTP status codes\nswitch (exception.name) {\n    case 'ConflictError':\n        return HttpStatus.CONFLICT;\n    case 'ForbiddenError':\n        return HttpStatus.FORBIDDEN;\n    case 'JsonWebTokenError':\n        return HttpStatus.UNAUTHORIZED;\n    case 'NotFoundError':\n        return HttpStatus.NOT_FOUND;\n    case 'PayloadTooLargeError':\n        return HttpStatus.PAYLOAD_TOO_LARGE;\n    case 'TimeoutError':\n        return HttpStatus.REQUEST_TIMEOUT;\n    case 'TokenExpiredError':\n        return HttpStatus.UNAUTHORIZED;\n    case 'TooManyRequestsError':\n        return HttpStatus.TOO_MANY_REQUESTS;\n    case 'UnauthorizedError':\n        return HttpStatus.UNAUTHORIZED;\n    case 'ValidationError':\n        return HttpStatus.BAD_REQUEST;\n    default:\n        return HttpStatus.INTERNAL_SERVER_ERROR;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"22-data-sanitization",children:"2.2 Data Sanitization"}),"\n",(0,i.jsx)(n.h4,{id:"sensitive-patterns",children:"Sensitive Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"private readonly sensitivePatterns = [\n    /password[s]?[:\\s=]+[^\\s]+/gi,        // Passwords\n    /token[s]?[:\\s=]+[^\\s]+/gi,            // Tokens\n    /key[s]?[:\\s=]+[^\\s]+/gi,              // API keys\n    /secret[s]?[:\\s=]+[^\\s]+/gi,           // Secrets\n    /api[_-]?key[s]?[:\\s=]+[^\\s]+/gi,     // API keys\n    /authorization[:\\s=]+[^\\s]+/gi,        // Authorization headers\n    /bearer\\s+[^\\s]+/gi,                   // Bearer tokens\n    /\\b\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}\\b/g, // Credit cards\n    /\\b\\d{3}-\\d{2}-\\d{4}\\b/g,              // SSN\n];\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sanitization-process",children:"Sanitization Process"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"private sanitizeString(input: string): string {\n    let sanitized = input;\n\n    this.sensitivePatterns.forEach((pattern) => {\n        sanitized = sanitized.replace(pattern, '[REDACTED]');\n    });\n\n    return sanitized;\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Sanitization ch\u1ec9 ho\u1ea1t \u0111\u1ed9ng trong production mode. Development mode s\u1ebd hi\u1ec3n th\u1ecb full error details \u0111\u1ec3 debugging."})}),"\n",(0,i.jsx)(n.h3,{id:"23-security-headers",children:"2.3 Security Headers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"private setSecurityHeaders(response: Response): void {\n    // Prevent information leakage\n    response.removeHeader('X-Powered-By');\n    response.setHeader('X-Content-Type-Options', 'nosniff');\n    response.setHeader('X-Frame-Options', 'DENY');\n    response.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n    response.setHeader('Pragma', 'no-cache');\n    response.setHeader('Expires', '0');\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"24-correlation-id-management",children:"2.4 Correlation ID Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"private getOrCreateCorrelationId(request: Request, response: Response): string {\n    // Check existing correlation IDs\n    const existingId =\n        request.headers['x-correlation-id'] ||\n        request.headers['x-request-id'] ||\n        request.headers['x-trace-id'];\n\n    const correlationId = existingId || uuidv4();\n\n    // Set response headers\n    response.setHeader('x-correlation-id', correlationId);\n    response.setHeader('x-request-id', correlationId);\n\n    return correlationId;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3-usage-examples",children:"3. Usage Examples"}),"\n",(0,i.jsx)(n.h3,{id:"31-basic-setup",children:"3.1 Basic Setup"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"basic",label:"Basic Configuration",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { HttpExceptionFilter } from '@ecom-co/utils';\n\n// Trong main.ts\napp.useGlobalFilters(\n    new HttpExceptionFilter(app.get(Reflector), { isDevelopment: process.env.NODE_ENV === 'development' }),\n);\n"})})}),(0,i.jsx)(a.A,{value:"advanced",label:"Advanced Configuration",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// V\u1edbi custom options v\xe0 external services\nconst filter = new HttpExceptionFilter(\n    app.get(Reflector),\n    {\n        isDevelopment: process.env.NODE_ENV === 'development',\n        enableSanitization: true,\n        enableMetrics: true,\n        enableRateLimitTracking: true,\n        customErrorMessages: {\n            404: 'Resource not found',\n            500: 'Internal server error occurred',\n        },\n    },\n    errorMetricsService, // ErrorMetrics implementation\n    rateLimitService, // RateLimitTracker implementation\n);\n\napp.useGlobalFilters(filter);\n"})})}),(0,i.jsx)(a.A,{value:"controller",label:"Controller Level",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// \xc1p d\u1ee5ng cho specific controller\n@Controller('users')\n@UseFilters(HttpExceptionFilter)\nexport class UsersController {\n    @Get()\n    async getUsers() {\n        // Controller methods\n    }\n}\n"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"32-custom-error-messages",children:"3.2 Custom Error Messages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// \u0110\u1ecbnh ngh\u0129a custom error messages\nconst customMessages = {\n    400: 'D\u1eef li\u1ec7u \u0111\u1ea7u v\xe0o kh\xf4ng h\u1ee3p l\u1ec7',\n    401: 'B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 truy c\u1eadp t\xe0i nguy\xean n\xe0y',\n    403: 'B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp t\xe0i nguy\xean n\xe0y',\n    404: 'Kh\xf4ng t\xecm th\u1ea5y t\xe0i nguy\xean y\xeau c\u1ea7u',\n    500: '\u0110\xe3 x\u1ea3y ra l\u1ed7i h\u1ec7 th\u1ed1ng, vui l\xf2ng th\u1eed l\u1ea1i sau',\n};\n\nconst filter = new HttpExceptionFilter(reflector, {\n    isDevelopment: false,\n    customErrorMessages: customMessages,\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"33-integration-v\u1edbi-error-metrics",children:"3.3 Integration v\u1edbi Error Metrics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Implement ErrorMetrics interface\nclass ErrorMetricsService implements ErrorMetrics {\n    increment(status: number, path: string, method: string) {\n        // Increment error count in monitoring system\n        // Example: Prometheus, DataDog, etc.\n        this.metrics.increment('http_errors_total', {\n            status: status.toString(),\n            path,\n            method,\n        });\n    }\n}\n\n// S\u1eed d\u1ee5ng v\u1edbi filter\nconst filter = new HttpExceptionFilter(reflector, { enableMetrics: true }, new ErrorMetricsService());\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-error-response-format",children:"4. Error Response Format"}),"\n",(0,i.jsx)(n.h3,{id:"standard-error-response",children:"Standard Error Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "error": "Bad Request",\n    "message": "Validation failed",\n    "statusCode": 400,\n    "path": "/api/users",\n    "requestId": "a1b2c3d4-e5f6-7890-1234-567890abcdef",\n    "timestamp": "2024-01-15T10:30:00.000Z",\n    "errors": ["Email is required", "Password must be at least 8 characters"],\n    "fieldErrors": {\n        "email": {\n            "isNotEmpty": "email should not be empty"\n        },\n        "password": {\n            "minLength": "password must be longer than or equal to 8 characters"\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"development-mode-response",children:"Development Mode Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "error": "Internal Server Error",\n    "message": "Database connection failed",\n    "statusCode": 500,\n    "path": "/api/users",\n    "requestId": "a1b2c3d4-e5f6-7890-1234-567890abcdef",\n    "timestamp": "2024-01-15T10:30:00.000Z",\n    "details": {\n        "code": "ECONNREFUSED",\n        "errno": -61\n    },\n    "method": "GET",\n    "userAgent": "Mozilla/5.0...",\n    "stack": "Error: connect ECONNREFUSED 127.0.0.1:5432..."\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"5-advanced-features",children:"5. Advanced Features"}),"\n",(0,i.jsx)(n.h3,{id:"51-rate-limit-tracking",children:"5.1 Rate Limit Tracking"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Implement RateLimitTracker interface\nclass RateLimitTrackerService implements RateLimitTracker {\n    track(ip: string, path: string) {\n        // Track rate limit violations\n        // Example: Redis, in-memory counter, etc.\n        const key = `rate_limit:${ip}:${path}`;\n        const count = this.redis.incr(key);\n\n        if (count === 1) {\n            this.redis.expire(key, 60); // 1 minute window\n        }\n\n        if (count > 100) {\n            // 100 requests per minute\n            this.alertService.notify(`Rate limit exceeded for ${ip} on ${path}`);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"52-error-logging",children:"5.2 Error Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Structured logging v\u1edbi context\nprivate logError(exception: unknown, status: number, request: Request, correlationId: string, clientIp: string): void {\n    const logContext = {\n        status,\n        clientIp,\n        method: request.method,\n        timestamp: new Date().toISOString(),\n        url: request.url,\n        userAgent: request.headers['user-agent'],\n        correlationId,\n    };\n\n    if (status >= 400 && status < 500) {\n        // Client errors - log as warning\n        this.logger.warn(`Client Error: ${status} ${request.method} ${request.url}`, logContext);\n    } else {\n        // Server errors - log as error with stack trace\n        this.logger.error(`Server Error: ${status} ${request.method} ${request.url}`, exception.stack, logContext);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"53-timeout-protection",children:"5.3 Timeout Protection"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"private sendErrorResponse(response: Response, status: number, errorPayload: ErrorResponseDto): void {\n    // Set timeout \u0111\u1ec3 tr\xe1nh hanging responses\n    const timeout = setTimeout(() => {\n        if (!response.headersSent) {\n            this.logger.error('Error response timed out');\n            response.end();\n        }\n    }, 5000); // 5 seconds timeout\n\n    try {\n        response.status(status).json(errorPayload);\n        clearTimeout(timeout);\n    } catch (error) {\n        clearTimeout(timeout);\n        this.logger.error('Failed to send error response', error);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"6-best-practices",children:"6. Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"61-security-considerations",children:"6.1 Security Considerations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always enable sanitization"})," trong production environment"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use custom error messages"})," \u0111\u1ec3 tr\xe1nh information leakage"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement rate limiting"})," \u0111\u1ec3 prevent abuse"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Set security headers"})," \u0111\u1ec3 enhance security posture"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Log errors appropriately"})," v\u1edbi proper log levels"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"62-performance-optimization",children:"6.2 Performance Optimization"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use correlation IDs"})," \u0111\u1ec3 track requests across services"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement metrics collection"})," \u0111\u1ec3 monitor error rates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Set reasonable timeouts"})," \u0111\u1ec3 prevent hanging responses"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use structured logging"})," \u0111\u1ec3 improve debugging efficiency"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"63-development-vs-production",children:"6.3 Development vs Production"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Development mode"}),": Full error details, stack traces, sensitive data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Production mode"}),": Sanitized messages, no sensitive data, minimal information"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Custom error messages"}),": Provide user-friendly messages trong production"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics collection"}),": Enable trong production \u0111\u1ec3 monitor application health"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"7-troubleshooting",children:"7. Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue 1: Filter kh\xf4ng catch \u0111\u01b0\u1ee3c exceptions"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Error: Exceptions kh\xf4ng \u0111\u01b0\u1ee3c handle b\u1edfi filter\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": \u0110\u1ea3m b\u1ea3o filter \u0111\u01b0\u1ee3c register \u0111\xfang c\xe1ch:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Trong main.ts\napp.useGlobalFilters(new HttpExceptionFilter(reflector, options));\n\n// Ho\u1eb7c trong module\n@Module({\n    providers: [\n        {\n            provide: APP_FILTER,\n            useClass: HttpExceptionFilter,\n        }\n    ]\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue 2: Sanitization kh\xf4ng ho\u1ea1t \u0111\u1ed9ng"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Error: Sensitive data v\u1eabn hi\u1ec3n th\u1ecb trong production\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Ki\u1ec3m tra configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const filter = new HttpExceptionFilter(reflector, {\n    isDevelopment: false, // Must be false\n    enableSanitization: true, // Must be true\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue 3: Custom error messages kh\xf4ng \u0111\u01b0\u1ee3c apply"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Error: Default error messages v\u1eabn hi\u1ec3n th\u1ecb\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": \u0110\u1ea3m b\u1ea3o custom messages \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a \u0111\xfang:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const customMessages = {\n    400: 'Custom bad request message',\n    404: 'Custom not found message',\n    // Must use numeric keys\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue 4: Metrics kh\xf4ng \u0111\u01b0\u1ee3c track"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Error: Error metrics kh\xf4ng \u0111\u01b0\u1ee3c increment\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Ki\u1ec3m tra ErrorMetrics implementation v\xe0 enable flag:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const filter = new HttpExceptionFilter(\n    reflector,\n    { enableMetrics: true }, // Must be true\n    errorMetricsService, // Must implement ErrorMetrics interface\n);\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Lu\xf4n test exception filter trong c\u1ea3 development v\xe0 production mode \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o behavior \u0111\xfang."})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Kh\xf4ng bao gi\u1edd disable sanitization trong production environment \u0111\u1ec3 tr\xe1nh sensitive data leakage."})}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsx)(n.p,{children:"Exception filter l\xe0 critical security component. H\xe3y review code k\u1ef9 l\u01b0\u1ee1ng tr\u01b0\u1edbc khi deploy production."})}),"\n",(0,i.jsx)(n.h2,{id:"8-integration-examples",children:"8. Integration Examples"}),"\n",(0,i.jsx)(n.h3,{id:"81-v\u1edbi-validation-pipe",children:"8.1 v\u1edbi Validation Pipe"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// main.ts\napp.useGlobalPipes(\n    new ValidationPipe({\n        transform: true,\n        whitelist: true,\n        forbidNonWhitelisted: true,\n        exceptionFactory: (errors) => {\n            return new ValidationException(errors);\n        },\n    }),\n);\n\napp.useGlobalFilters(\n    new HttpExceptionFilter(reflector, {\n        isDevelopment: process.env.NODE_ENV === 'development',\n    }),\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"82-v\u1edbi-logger-service",children:"8.2 v\u1edbi Logger Service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Custom logger integration\nclass CustomLogger extends Logger {\n    error(message: string, trace?: string, context?: string) {\n        // Custom error logging logic\n        super.error(message, trace, context);\n\n        // Additional logging to external service\n        this.externalLogger.log('ERROR', message, { trace, context });\n    }\n}\n\n// S\u1eed d\u1ee5ng v\u1edbi filter\nconst filter = new HttpExceptionFilter(reflector, options, errorMetrics, rateLimitTracker);\nfilter['logger'] = new CustomLogger(HttpExceptionFilter.name);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"83-v\u1edbi-monitoring-systems",children:"8.3 v\u1edbi Monitoring Systems"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Prometheus metrics integration\nclass PrometheusErrorMetrics implements ErrorMetrics {\n    private errorCounter = new Counter({\n        name: 'http_errors_total',\n        help: 'Total number of HTTP errors',\n        labelNames: ['status', 'path', 'method'],\n    });\n\n    increment(status: number, path: string, method: string) {\n        this.errorCounter.inc({ status: status.toString(), path, method });\n    }\n}\n\n// S\u1eed d\u1ee5ng v\u1edbi filter\nconst filter = new HttpExceptionFilter(reflector, { enableMetrics: true }, new PrometheusErrorMetrics());\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);