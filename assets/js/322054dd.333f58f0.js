"use strict";(self.webpackChunktemplate_docs=self.webpackChunktemplate_docs||[]).push([[1273],{11470:(e,n,r)=>{r.d(n,{A:()=>b});var t=r(96540),o=r(34164),s=r(23104),l=r(56347),c=r(205),i=r(57485),a=r(31682),d=r(70679);function h(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:r}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:r,default:t}})=>({value:e,label:n,attributes:r,default:t}))}(r);return function(e){const n=(0,a.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function p({queryString:e=!1,groupId:n}){const r=(0,l.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,i.aZ)(o),(0,t.useCallback)(e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})},[o,r])]}function x(e){const{defaultValue:n,queryString:r=!1,groupId:o}=e,s=u(e),[l,i]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s})),[a,h]=p({queryString:r,groupId:o}),[x,j]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,o]=(0,d.Dv)(n);return[r,(0,t.useCallback)(e=>{n&&o.set(e)},[n,o])]}({groupId:o}),g=(()=>{const e=a??x;return m({value:e,tabValues:s})?e:null})();(0,c.A)(()=>{g&&i(g)},[g]);return{selectedValue:l,selectValue:(0,t.useCallback)(e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),h(e),j(e)},[h,j,s]),tabValues:s}}var j=r(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=r(74848);function y({className:e,block:n,selectedValue:r,selectValue:t,tabValues:l}){const c=[],{blockElementScrollPositionUntilNextRender:i}=(0,s.a_)(),a=e=>{const n=e.currentTarget,o=c.indexOf(n),s=l[o].value;s!==r&&(i(n),t(s))},d=e=>{let n=null;switch(e.key){case"Enter":a(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:l.map(({value:e,label:n,attributes:t})=>(0,v.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{c.push(e)},onKeyDown:d,onClick:a,...t,className:(0,o.A)("tabs__item",g.tabItem,t?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function f({lazy:e,children:n,selectedValue:r}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===r);return e?(0,t.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function M(e){const n=x(e);return(0,v.jsxs)("div",{className:(0,o.A)("tabs-container",g.tabList),children:[(0,v.jsx)(y,{...n,...e}),(0,v.jsx)(f,{...n,...e})]})}function b(e){const n=(0,j.A)();return(0,v.jsx)(M,{...e,children:h(e.children)},String(n))}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>c});var t=r(96540);const o={},s=t.createContext(o);function l(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(s.Provider,{value:n},e.children)}},92109:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"ecom-co/libs/typeorm/docs/orm-module","title":"ORM Module \u2014 NestJS Integration v\u1edbi Health Check","description":"ORM Module l\xe0 wrapper cho NestJS TypeORM v\u1edbi c\xe1c t\xednh n\u0103ng n\xe2ng cao nh\u01b0 health check, global module support v\xe0 extended repository providers.","source":"@site/docs/ecom-co/libs/typeorm/docs/orm-module.md","sourceDirName":"ecom-co/libs/typeorm/docs","slug":"/orm-module","permalink":"/document/docs/orm-module","draft":false,"unlisted":false,"editUrl":"https://github.com/ecom-co/document/tree/main/docs/ecom-co/libs/typeorm/docs/orm-module.md","tags":[{"inline":true,"label":"orm-module","permalink":"/document/docs/tags/orm-module"},{"inline":true,"label":"nestjs","permalink":"/document/docs/tags/nestjs"},{"inline":true,"label":"health-check","permalink":"/document/docs/tags/health-check"},{"inline":true,"label":"global-module","permalink":"/document/docs/tags/global-module"},{"inline":true,"label":"async-configuration","permalink":"/document/docs/tags/async-configuration"}],"version":"current","frontMatter":{"id":"orm-module","title":"ORM Module \u2014 NestJS Integration v\u1edbi Health Check","sidebar_label":"ORM Module","slug":"/orm-module","description":"ORM Module l\xe0 wrapper cho NestJS TypeORM v\u1edbi c\xe1c t\xednh n\u0103ng n\xe2ng cao nh\u01b0 health check, global module support v\xe0 extended repository providers.","tags":["orm-module","nestjs","health-check","global-module","async-configuration"]},"sidebar":"tutorialSidebar","previous":{"title":"Core Module","permalink":"/document/docs/core-module"},"next":{"title":"Data Source","permalink":"/document/docs/data-source"}}');var o=r(74848),s=r(28453);r(11470);const l={id:"orm-module",title:"ORM Module \u2014 NestJS Integration v\u1edbi Health Check",sidebar_label:"ORM Module",slug:"/orm-module",description:"ORM Module l\xe0 wrapper cho NestJS TypeORM v\u1edbi c\xe1c t\xednh n\u0103ng n\xe2ng cao nh\u01b0 health check, global module support v\xe0 extended repository providers.",tags:["orm-module","nestjs","health-check","global-module","async-configuration"]},c=void 0,i={},a=[{value:"T\u1ed5ng quan",id:"t\u1ed5ng-quan",level:2},{value:"OrmModule",id:"ormmodule",level:2},{value:"Decorators",id:"decorators",level:3},{value:"Static Methods",id:"static-methods",level:2},{value:"forRoot",id:"forroot",level:3},{value:"Parameters",id:"parameters",level:4},{value:"OrmModuleOptions",id:"ormmoduleoptions",level:4},{value:"Returns",id:"returns",level:4},{value:"V\xed d\u1ee5 s\u1eed d\u1ee5ng",id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng",level:4},{value:"forRootAsync",id:"forrootasync",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"OrmModuleAsyncOptions",id:"ormmoduleasyncoptions",level:4},{value:"Returns",id:"returns-1",level:4},{value:"V\xed d\u1ee5 s\u1eed d\u1ee5ng",id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-1",level:4},{value:"forFeature",id:"forfeature",level:3},{value:"Parameters",id:"parameters-2",level:4},{value:"Returns",id:"returns-2",level:4},{value:"V\xed d\u1ee5 s\u1eed d\u1ee5ng",id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-2",level:4},{value:"forFeatureExtended",id:"forfeatureextended",level:3},{value:"Parameters",id:"parameters-3",level:4},{value:"Returns",id:"returns-3",level:4},{value:"V\xed d\u1ee5 s\u1eed d\u1ee5ng",id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-3",level:4},{value:"Health Check",id:"health-check",level:2},{value:"Health Check Provider",id:"health-check-provider",level:3},{value:"Health Check Function",id:"health-check-function",level:3},{value:"Health Check Implementation",id:"health-check-implementation",level:3},{value:"Parameters",id:"parameters-4",level:4},{value:"Returns",id:"returns-4",level:4},{value:"Health Check Result",id:"health-check-result",level:4},{value:"V\xed d\u1ee5 Result",id:"v\xed-d\u1ee5-result",level:4},{value:"S\u1eed d\u1ee5ng Health Check",id:"s\u1eed-d\u1ee5ng-health-check",level:3},{value:"1. Inject Health Check Provider",id:"1-inject-health-check-provider",level:4},{value:"2. S\u1eed d\u1ee5ng trong Terminus Health Check",id:"2-s\u1eed-d\u1ee5ng-trong-terminus-health-check",level:4},{value:"3. Health Controller",id:"3-health-controller",level:4},{value:"Multiple Data Sources",id:"multiple-data-sources",level:2},{value:"C\u1ea5u h\xecnh nhi\u1ec1u Data Sources",id:"c\u1ea5u-h\xecnh-nhi\u1ec1u-data-sources",level:3},{value:"S\u1eed d\u1ee5ng trong Feature Modules",id:"s\u1eed-d\u1ee5ng-trong-feature-modules",level:3},{value:"V\xed d\u1ee5 ho\xe0n ch\u1ec9nh",id:"v\xed-d\u1ee5-ho\xe0n-ch\u1ec9nh",level:2},{value:"App Module v\u1edbi Health Check",id:"app-module-v\u1edbi-health-check",level:3},{value:"Feature Module v\u1edbi Extended Repository",id:"feature-module-v\u1edbi-extended-repository",level:3},{value:"Service v\u1edbi BaseRepository",id:"service-v\u1edbi-baserepository",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Migration t\u1eeb TypeOrmModule",id:"migration-t\u1eeb-typeormmodule",level:2},{value:"Thay th\u1ebf TypeOrmModule.forRoot",id:"thay-th\u1ebf-typeormmoduleforroot",level:3},{value:"Thay th\u1ebf TypeOrmModule.forFeature",id:"thay-th\u1ebf-typeormmoduleforfeature",level:3}];function d(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"ORM Module l\xe0 wrapper cho NestJS TypeORM module, cung c\u1ea5p c\xe1c t\xednh n\u0103ng n\xe2ng cao nh\u01b0 health check capabilities, global module support, async configuration v\xe0 extended repository providers."})}),"\n",(0,o.jsx)(n.h2,{id:"t\u1ed5ng-quan",children:"T\u1ed5ng quan"}),"\n",(0,o.jsx)(n.p,{children:"ORM Module bao g\u1ed3m:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"OrmModule"})," - Global NestJS module v\u1edbi TypeORM integration"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Health Check"})," - Database health monitoring v\u1edbi latency measurement"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Global Module"})," - Available trong to\xe0n b\u1ed9 application"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Async Configuration"})," - Dynamic configuration t\u1eeb ConfigService"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Extended Repository"})," - T\u1ef1 \u0111\u1ed9ng t\u1ea1o BaseRepository providers"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"ormmodule",children:"OrmModule"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"OrmModule"})," l\xe0 global NestJS module wrapper cho TypeORM v\u1edbi c\xe1c t\xednh n\u0103ng n\xe2ng cao."]}),"\n",(0,o.jsx)(n.h3,{id:"decorators",children:"Decorators"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@Global()\n@Module({})\nexport class OrmModule\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"@Global()"})," - Module c\xf3 s\u1eb5n trong to\xe0n b\u1ed9 application"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["@Module(",")"]})," - Empty module, t\u1ea5t c\u1ea3 logic trong static methods"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"static-methods",children:"Static Methods"}),"\n",(0,o.jsx)(n.h3,{id:"forroot",children:"forRoot"}),"\n",(0,o.jsx)(n.p,{children:"C\u1ea5u h\xecnh TypeORM module \u0111\u1ed3ng b\u1ed9 v\u1edbi health check option."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"static forRoot(options: OrmModuleOptions): DynamicModule\n"})}),"\n",(0,o.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsx)(n.tbody,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"options"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"OrmModuleOptions"})}),(0,o.jsx)(n.td,{children:"\u2705"}),(0,o.jsx)(n.td,{children:"C\u1ea5u h\xecnh TypeORM v\u1edbi health check option"})]})})]}),"\n",(0,o.jsx)(n.h4,{id:"ormmoduleoptions",children:"OrmModuleOptions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export type OrmModuleOptions = TypeOrmModuleOptions & {\n    /** N\u1ebfu true, cung c\u1ea5p health check provider cho database connection */\n    health?: boolean;\n};\n"})}),"\n",(0,o.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"DynamicModule"})," - Module \u0111\xe3 \u0111\u01b0\u1ee3c c\u1ea5u h\xecnh v\u1edbi health check provider (n\u1ebfu b\u1eadt)"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng",children:"V\xed d\u1ee5 s\u1eed d\u1ee5ng"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User, Product } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        OrmModule.forRoot({\n            type: 'postgres',\n            url: process.env.DATABASE_URL,\n            entities: [User, Product],\n            health: true, // B\u1eadt health check\n        }),\n    ],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"forrootasync",children:"forRootAsync"}),"\n",(0,o.jsx)(n.p,{children:"C\u1ea5u h\xecnh TypeORM module b\u1ea5t \u0111\u1ed3ng b\u1ed9 v\u1edbi health check option."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"static forRootAsync(options: OrmModuleAsyncOptions): DynamicModule\n"})}),"\n",(0,o.jsx)(n.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsx)(n.tbody,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"options"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"OrmModuleAsyncOptions"})}),(0,o.jsx)(n.td,{children:"\u2705"}),(0,o.jsx)(n.td,{children:"C\u1ea5u h\xecnh TypeORM async v\u1edbi health check option"})]})})]}),"\n",(0,o.jsx)(n.h4,{id:"ormmoduleasyncoptions",children:"OrmModuleAsyncOptions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export type OrmModuleAsyncOptions = TypeOrmModuleAsyncOptions & {\n    /** N\u1ebfu true, cung c\u1ea5p health check provider cho database connection */\n    health?: boolean;\n};\n"})}),"\n",(0,o.jsx)(n.h4,{id:"returns-1",children:"Returns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"DynamicModule"})," - Module \u0111\xe3 \u0111\u01b0\u1ee3c c\u1ea5u h\xecnh v\u1edbi async configuration v\xe0 health check provider"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-1",children:"V\xed d\u1ee5 s\u1eed d\u1ee5ng"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User, Product } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        ConfigModule.forRoot(),\n        OrmModule.forRootAsync({\n            imports: [ConfigModule],\n            inject: [ConfigService],\n            useFactory: (config: ConfigService) => ({\n                type: 'postgres',\n                url: config.get('DATABASE_URL'),\n                entities: [User, Product],\n                health: true, // B\u1eadt health check\n            }),\n        }),\n    ],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"forfeature",children:"forFeature"}),"\n",(0,o.jsx)(n.p,{children:"\u0110\u0103ng k\xfd entities cho feature module (t\u01b0\u01a1ng t\u1ef1 TypeOrmModule.forFeature)."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"static forFeature = (\n  entities: EntityClassOrSchema[],\n  dataSource?: string\n): DynamicModule\n"})}),"\n",(0,o.jsx)(n.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"entities"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"EntityClassOrSchema[]"})}),(0,o.jsx)(n.td,{children:"\u2705"}),(0,o.jsx)(n.td,{children:"M\u1ea3ng entities \u0111\u1ec3 \u0111\u0103ng k\xfd"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"dataSource"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"string"})}),(0,o.jsx)(n.td,{children:"\u274c"}),(0,o.jsx)(n.td,{children:"T\xean data source connection (n\u1ebfu c\xf3 nhi\u1ec1u)"})]})]})]}),"\n",(0,o.jsx)(n.h4,{id:"returns-2",children:"Returns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"DynamicModule"})," - Feature module v\u1edbi entities \u0111\xe3 \u0111\u0103ng k\xfd"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-2",children:"V\xed d\u1ee5 s\u1eed d\u1ee5ng"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User } from '@ecom-co/orm';\n\n@Module({\n    imports: [OrmModule.forFeature([User])],\n})\nexport class UserModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"forfeatureextended",children:"forFeatureExtended"}),"\n",(0,o.jsxs)(n.p,{children:["\u0110\u0103ng k\xfd entities v\xe0 cung c\u1ea5p extended ",(0,o.jsx)(n.code,{children:"BaseRepository"})," cho ch\xfang."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"static forFeatureExtended = (\n  entities: EntityClassOrSchema[],\n  dataSource?: string\n): DynamicModule\n"})}),"\n",(0,o.jsx)(n.h4,{id:"parameters-3",children:"Parameters"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"entities"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"EntityClassOrSchema[]"})}),(0,o.jsx)(n.td,{children:"\u2705"}),(0,o.jsx)(n.td,{children:"M\u1ea3ng entities \u0111\u1ec3 \u0111\u0103ng k\xfd"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"dataSource"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"string"})}),(0,o.jsx)(n.td,{children:"\u274c"}),(0,o.jsx)(n.td,{children:"T\xean data source connection (n\u1ebfu c\xf3 nhi\u1ec1u)"})]})]})]}),"\n",(0,o.jsx)(n.h4,{id:"returns-3",children:"Returns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"DynamicModule"})," - Feature module v\u1edbi BaseRepository providers"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"v\xed-d\u1ee5-s\u1eed-d\u1ee5ng-3",children:"V\xed d\u1ee5 s\u1eed d\u1ee5ng"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User, Product } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        OrmModule.forFeatureExtended([User, Product]), // T\u1ef1 \u0111\u1ed9ng t\u1ea1o BaseRepository providers\n    ],\n})\nexport class CoreModule {}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"health-check",children:"Health Check"}),"\n",(0,o.jsx)(n.h3,{id:"health-check-provider",children:"Health Check Provider"}),"\n",(0,o.jsxs)(n.p,{children:["Khi b\u1eadt ",(0,o.jsx)(n.code,{children:"health: true"}),", OrmModule t\u1ef1 \u0111\u1ed9ng t\u1ea1o health check provider:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export const ORM_HEALTH_CHECK = Symbol('ORM_HEALTH_CHECK');\n"})}),"\n",(0,o.jsx)(n.h3,{id:"health-check-function",children:"Health Check Function"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export type OrmHealthCheckFn = (key?: string) => Promise<HealthIndicatorResult>;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"health-check-implementation",children:"Health Check Implementation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export const checkTypeOrmHealthy = async (\n  dataSource: DataSource,\n  key: string = ORM_HEALTH_KEY,\n): Promise<HealthIndicatorResult>\n"})}),"\n",(0,o.jsx)(n.h4,{id:"parameters-4",children:"Parameters"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"dataSource"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"DataSource"})}),(0,o.jsx)(n.td,{children:"\u2705"}),(0,o.jsx)(n.td,{children:"TypeORM DataSource instance"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"key"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"string"})}),(0,o.jsx)(n.td,{children:"\u274c"}),(0,o.jsx)(n.td,{children:"Key cho health status (m\u1eb7c \u0111\u1ecbnh: 'db')"})]})]})]}),"\n",(0,o.jsx)(n.h4,{id:"returns-4",children:"Returns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"HealthIndicatorResult"})," - Health check result v\u1edbi status v\xe0 latency"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"health-check-result",children:"Health Check Result"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export type HealthIndicatorResult = Record<\n    string,\n    {\n        [k: string]: unknown;\n        latencyMs: number;\n        status: 'down' | 'up';\n    }\n>;\n"})}),"\n",(0,o.jsx)(n.h4,{id:"v\xed-d\u1ee5-result",children:"V\xed d\u1ee5 Result"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Success case\n{\n  db: {\n    status: 'up',\n    latencyMs: 12\n  }\n}\n\n// Error case\n{\n  db: {\n    status: 'down',\n    error: 'Connection failed',\n    latencyMs: 150\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"s\u1eed-d\u1ee5ng-health-check",children:"S\u1eed d\u1ee5ng Health Check"}),"\n",(0,o.jsx)(n.h4,{id:"1-inject-health-check-provider",children:"1. Inject Health Check Provider"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/common';\nimport { ORM_HEALTH_CHECK, OrmHealthCheckFn } from '@ecom-co/orm';\n\n@Injectable()\nexport class HealthService {\n    constructor(\n        @Inject(ORM_HEALTH_CHECK)\n        private healthCheck: OrmHealthCheckFn,\n    ) {}\n\n    async checkDatabaseHealth(): Promise<any> {\n        return this.healthCheck('database');\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"2-s\u1eed-d\u1ee5ng-trong-terminus-health-check",children:"2. S\u1eed d\u1ee5ng trong Terminus Health Check"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/terminus';\nimport { HealthIndicator, HealthIndicatorResult } from '@nestjs/terminus';\nimport { ORM_HEALTH_CHECK, OrmHealthCheckFn } from '@ecom-co/orm';\n\n@Injectable()\nexport class DatabaseHealthIndicator extends HealthIndicator {\n    constructor(\n        @Inject(ORM_HEALTH_CHECK)\n        private healthCheck: OrmHealthCheckFn,\n    ) {\n        super();\n    }\n\n    async isHealthy(key: string): Promise<HealthIndicatorResult> {\n        try {\n            const result = await this.healthCheck(key);\n            return result;\n        } catch (error) {\n            return this.getStatus(key, false, { message: error.message });\n        }\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"3-health-controller",children:"3. Health Controller"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Controller, Get } from '@nestjs/common';\nimport { HealthCheck, HealthCheckService } from '@nestjs/terminus';\nimport { DatabaseHealthIndicator } from './database.health';\n\n@Controller('health')\nexport class HealthController {\n    constructor(\n        private health: HealthCheckService,\n        private db: DatabaseHealthIndicator,\n    ) {}\n\n    @Get()\n    @HealthCheck()\n    check() {\n        return this.health.check([() => this.db.isHealthy('database')]);\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"multiple-data-sources",children:"Multiple Data Sources"}),"\n",(0,o.jsx)(n.h3,{id:"c\u1ea5u-h\xecnh-nhi\u1ec1u-data-sources",children:"C\u1ea5u h\xecnh nhi\u1ec1u Data Sources"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        // Primary database\n        OrmModule.forRoot({\n            name: 'default',\n            type: 'postgres',\n            url: process.env.DATABASE_URL,\n            entities: [User, Product],\n            health: true,\n        }),\n\n        // Analytics database\n        OrmModule.forRoot({\n            name: 'analytics',\n            type: 'postgres',\n            url: process.env.ANALYTICS_DATABASE_URL,\n            entities: [AnalyticsEvent],\n            health: true,\n        }),\n    ],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"s\u1eed-d\u1ee5ng-trong-feature-modules",children:"S\u1eed d\u1ee5ng trong Feature Modules"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        // S\u1eed d\u1ee5ng default data source\n        OrmModule.forFeature([User], 'default'),\n\n        // S\u1eed d\u1ee5ng analytics data source\n        OrmModule.forFeature([AnalyticsEvent], 'analytics'),\n    ],\n})\nexport class AnalyticsModule {}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"v\xed-d\u1ee5-ho\xe0n-ch\u1ec9nh",children:"V\xed d\u1ee5 ho\xe0n ch\u1ec9nh"}),"\n",(0,o.jsx)(n.h3,{id:"app-module-v\u1edbi-health-check",children:"App Module v\u1edbi Health Check"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { TerminusModule } from '@nestjs/terminus';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User, Product, CORE_ENTITIES } from '@ecom-co/orm';\nimport { HealthController } from './health.controller';\nimport { DatabaseHealthIndicator } from './database.health';\n\n@Module({\n    imports: [\n        ConfigModule.forRoot(),\n        TerminusModule,\n\n        // ORM Module v\u1edbi health check\n        OrmModule.forRootAsync({\n            imports: [ConfigModule],\n            inject: [ConfigService],\n            useFactory: (config: ConfigService) => ({\n                type: 'postgres',\n                url: config.get('DATABASE_URL'),\n                entities: CORE_ENTITIES,\n                health: true, // B\u1eadt health check\n                logging: config.get('NODE_ENV') !== 'production',\n            }),\n        }),\n    ],\n    controllers: [HealthController],\n    providers: [DatabaseHealthIndicator],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"feature-module-v\u1edbi-extended-repository",children:"Feature Module v\u1edbi Extended Repository"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { OrmModule } from '@ecom-co/orm';\nimport { User, Product } from '@ecom-co/orm';\nimport { UserService } from './user.service';\nimport { ProductService } from './product.service';\n\n@Module({\n    imports: [\n        // S\u1eed d\u1ee5ng extended repository\n        OrmModule.forFeatureExtended([User, Product]),\n    ],\n    providers: [UserService, ProductService],\n    exports: [UserService, ProductService],\n})\nexport class CoreModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"service-v\u1edbi-baserepository",children:"Service v\u1edbi BaseRepository"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { BaseRepository } from '@ecom-co/orm';\nimport { User } from '@ecom-co/orm';\n\n@Injectable()\nexport class UserService {\n    constructor(\n        @InjectRepository(User)\n        private userRepo: BaseRepository<User>, // S\u1eed d\u1ee5ng BaseRepository\n    ) {}\n\n    async findOrCreate(email: string): Promise<User> {\n        return this.userRepo.findOneOrCreate({ email }, { isActive: true });\n    }\n\n    async updateOrCreate(email: string, userData: Partial<User>): Promise<User> {\n        return this.userRepo.findOneAndUpdate({ email }, userData, { upsert: true });\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use Health Check"}),": Lu\xf4n b\u1eadt health check trong production \u0111\u1ec3 monitor database health."]})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Global Module"}),": OrmModule l\xe0 global module, kh\xf4ng c\u1ea7n import l\u1ea1i trong c\xe1c feature modules."]})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"forFeatureExtended"}),": S\u1eed d\u1ee5ng ",(0,o.jsx)(n.code,{children:"forFeatureExtended"})," khi c\u1ea7n BaseRepository methods."]})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Multiple Data Sources"}),": Khi s\u1eed d\u1ee5ng nhi\u1ec1u data sources, \u0111\u1ea3m b\u1ea3o \u0111\u1eb7t t\xean r\xf5 r\xe0ng v\xe0 s\u1eed d\u1ee5ng \u0111\xfang t\xean trong feature modules."]})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Async Configuration"}),": S\u1eed d\u1ee5ng ",(0,o.jsx)(n.code,{children:"forRootAsync"})," khi c\u1ea7n dynamic configuration t\u1eeb ConfigService ho\u1eb7c external sources."]})}),"\n",(0,o.jsx)(n.h2,{id:"migration-t\u1eeb-typeormmodule",children:"Migration t\u1eeb TypeOrmModule"}),"\n",(0,o.jsx)(n.h3,{id:"thay-th\u1ebf-typeormmoduleforroot",children:"Thay th\u1ebf TypeOrmModule.forRoot"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// \u274c C\u0169\nimport { TypeOrmModule } from '@nestjs/typeorm';\n\n@Module({\n    imports: [\n        TypeOrmModule.forRoot({\n            type: 'postgres',\n            url: process.env.DATABASE_URL,\n            entities: [User, Product],\n        }),\n    ],\n})\nexport class AppModule {}\n\n// \u2705 M\u1edbi\nimport { OrmModule } from '@ecom-co/orm';\n\n@Module({\n    imports: [\n        OrmModule.forRoot({\n            type: 'postgres',\n            url: process.env.DATABASE_URL,\n            entities: [User, Product],\n            health: true, // Th\xeam health check\n        }),\n    ],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"thay-th\u1ebf-typeormmoduleforfeature",children:"Thay th\u1ebf TypeOrmModule.forFeature"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// \u274c C\u0169\nimport { TypeOrmModule } from '@nestjs/typeorm';\n\n@Module({\n    imports: [TypeOrmModule.forFeature([User, Product])],\n})\nexport class UserModule {}\n\n// \u2705 M\u1edbi - Standard repository\nimport { OrmModule } from '@ecom-co/orm';\n\n@Module({\n    imports: [OrmModule.forFeature([User, Product])],\n})\nexport class UserModule {}\n\n// \u2705 M\u1edbi - Extended repository\n@Module({\n    imports: [OrmModule.forFeatureExtended([User, Product])],\n})\nexport class UserModule {}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);